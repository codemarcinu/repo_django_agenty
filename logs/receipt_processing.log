[2025-08-15 12:30:45] DEBUG in chatbot.services.receipt_service: DEBUG test message from chatbot.services.receipt_service
[2025-08-15 12:30:45] INFO in chatbot.services.receipt_service: INFO test message from chatbot.services.receipt_service
[2025-08-15 12:30:45] WARNING in chatbot.services.receipt_service: WARNING test message from chatbot.services.receipt_service
[2025-08-15 12:30:45] ERROR in chatbot.services.receipt_service: ERROR test message from chatbot.services.receipt_service
[2025-08-15 12:30:45] DEBUG in chatbot.receipt_processor: DEBUG test message from chatbot.receipt_processor
[2025-08-15 12:30:45] INFO in chatbot.receipt_processor: INFO test message from chatbot.receipt_processor
[2025-08-15 12:30:45] WARNING in chatbot.receipt_processor: WARNING test message from chatbot.receipt_processor
[2025-08-15 12:30:45] ERROR in chatbot.receipt_processor: ERROR test message from chatbot.receipt_processor
[2025-08-15 12:30:45] DEBUG in chatbot.tasks: DEBUG test message from chatbot.tasks
[2025-08-15 12:30:45] INFO in chatbot.tasks: INFO test message from chatbot.tasks
[2025-08-15 12:30:45] WARNING in chatbot.tasks: WARNING test message from chatbot.tasks
[2025-08-15 12:30:45] ERROR in chatbot.tasks: ERROR test message from chatbot.tasks
[2025-08-15 12:32:48] INFO in chatbot.services.receipt_service: Created receipt processing record: 11
[2025-08-15 12:32:48] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 11
[2025-08-15 12:32:48] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 11 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-15 12:32:48] INFO in chatbot.services.receipt_service: Marking receipt 11 as processing...
[2025-08-15 12:32:48] DEBUG in chatbot.services.receipt_service: Receipt 11 status updated to: ocr_in_progress
[2025-08-15 12:32:48] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 11
[2025-08-15 12:32:48] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-15 12:33:07] WARNING in chatbot.services.receipt_service: ‚ö†Ô∏è Celery task failed for receipt 11: Error 111 connecting to localhost:6379. Connection refused.
[2025-08-15 12:33:07] INFO in chatbot.services.receipt_service: Falling back to synchronous processing for receipt 11
[2025-08-15 12:33:07] DEBUG in chatbot.services.receipt_service: Receipt processor imported successfully
[2025-08-15 12:33:07] INFO in chatbot.services.receipt_service: Starting synchronous OCR processing for receipt 11
[2025-08-15 12:33:07] INFO in chatbot.services.receipt_service: ‚úÖ Completed synchronous processing for receipt 11
[2025-08-15 12:33:07] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 11
[2025-08-15 16:07:03] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 1: /fake/receipt.pdf
[2025-08-15 16:07:03] ERROR in chatbot.services.receipt_service: OCR failed for receipt 1: Could not extract text
[2025-08-15 16:07:03] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 1: /fake/receipt.pdf
[2025-08-15 16:07:03] ERROR in chatbot.services.receipt_service: No OCR backends available
[2025-08-15 16:07:03] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 1: /fake/receipt.pdf
[2025-08-15 16:07:03] INFO in chatbot.services.receipt_service: OCR completed for receipt 1: 42 characters extracted
[2025-08-15 16:08:12] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 1: /fake/receipt.pdf
[2025-08-15 16:08:12] ERROR in chatbot.services.receipt_service: OCR failed for receipt 1: Could not extract text
[2025-08-15 16:08:12] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 1: /fake/receipt.pdf
[2025-08-15 16:08:12] ERROR in chatbot.services.receipt_service: No OCR backends available
[2025-08-15 16:08:12] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 1: /fake/receipt.pdf
[2025-08-15 16:08:12] INFO in chatbot.services.receipt_service: OCR completed for receipt 1: 42 characters extracted
[2025-08-15 16:09:47] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 1: /fake/receipt.pdf
[2025-08-15 16:09:47] ERROR in chatbot.services.receipt_service: OCR failed for receipt 1: Could not extract text
[2025-08-15 16:09:47] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 1: /fake/receipt.pdf
[2025-08-15 16:09:47] ERROR in chatbot.services.receipt_service: No OCR backends available
[2025-08-15 16:09:47] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 1: /fake/receipt.pdf
[2025-08-15 16:09:47] INFO in chatbot.services.receipt_service: OCR completed for receipt 1: 42 characters extracted
[2025-08-15 16:20:54] ERROR in chatbot.services.receipt_service: Receipt 1 has empty OCR text
[2025-08-15 16:20:54] ERROR in chatbot.services.receipt_service: Receipt 1 has no valid OCR text data
[2025-08-15 16:20:54] INFO in chatbot.services.receipt_service: Starting parsing for receipt 1: 277 characters
[2025-08-15 16:20:54] INFO in chatbot.services.receipt_service: Parsing completed for receipt 1: 5 products extracted
[2025-08-15 16:20:54] WARNING in chatbot.services.receipt_service: Receipt 1 is not in ocr_completed status: pending_ocr
[2025-08-15 16:21:37] ERROR in chatbot.services.receipt_service: Receipt 1 has empty OCR text
[2025-08-15 16:21:37] ERROR in chatbot.services.receipt_service: Receipt 1 has no valid OCR text data
[2025-08-15 16:21:37] INFO in chatbot.services.receipt_service: Starting parsing for receipt 1: 277 characters
[2025-08-15 16:21:37] INFO in chatbot.services.receipt_service: Parsing completed for receipt 1: 5 products extracted
[2025-08-15 16:21:37] WARNING in chatbot.services.receipt_service: Receipt 1 is not in ocr_completed status: pending_ocr
[2025-08-15 17:40:20] INFO in chatbot.services.receipt_service: Created receipt processing record: 12
[2025-08-15 17:40:20] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 12
[2025-08-15 17:40:20] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 12 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-15 17:40:20] INFO in chatbot.services.receipt_service: Marking receipt 12 as processing...
[2025-08-15 17:40:20] DEBUG in chatbot.services.receipt_service: Receipt 12 status updated to: ocr_in_progress
[2025-08-15 17:40:20] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 12
[2025-08-15 17:40:20] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-15 17:40:39] WARNING in chatbot.services.receipt_service: ‚ö†Ô∏è Celery task failed for receipt 12: Error 111 connecting to localhost:6379. Connection refused.
[2025-08-15 17:40:39] INFO in chatbot.services.receipt_service: Falling back to synchronous processing for receipt 12
[2025-08-15 17:40:39] DEBUG in chatbot.services.receipt_service: Receipt processor imported successfully
[2025-08-15 17:40:39] INFO in chatbot.services.receipt_service: Starting synchronous OCR processing for receipt 12
[2025-08-15 17:40:39] INFO in chatbot.services.receipt_service: ‚úÖ Completed synchronous processing for receipt 12
[2025-08-15 17:40:39] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 12
[2025-08-15 17:46:43] INFO in chatbot.services.receipt_service: Created receipt processing record: 13
[2025-08-15 17:46:43] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 13
[2025-08-15 17:46:43] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 13 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-15 17:46:43] INFO in chatbot.services.receipt_service: Marking receipt 13 as processing...
[2025-08-15 17:46:43] DEBUG in chatbot.services.receipt_service: Receipt 13 status updated to: ocr_in_progress
[2025-08-15 17:46:43] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 13
[2025-08-15 17:46:43] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-15 17:47:02] WARNING in chatbot.services.receipt_service: ‚ö†Ô∏è Celery task failed for receipt 13: Error 111 connecting to localhost:6379. Connection refused.
[2025-08-15 17:47:02] INFO in chatbot.services.receipt_service: Falling back to synchronous processing for receipt 13
[2025-08-15 17:47:02] DEBUG in chatbot.services.receipt_service: Receipt processor imported successfully
[2025-08-15 17:47:02] INFO in chatbot.services.receipt_service: Starting synchronous OCR processing for receipt 13
[2025-08-15 17:47:02] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 13
[2025-08-15 17:47:02] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-15 17:47:02] INFO in chatbot.receipt_processor: ‚úÖ Found receipt record: 13, current status: ocr_in_progress
[2025-08-15 17:47:02] INFO in chatbot.receipt_processor: Updating receipt 13 status to 'ocr_in_progress'
[2025-08-15 17:47:02] DEBUG in chatbot.receipt_processor: Receipt 13 status updated successfully
[2025-08-15 17:47:02] INFO in chatbot.receipt_processor: Processing file: /home/marcin/PycharmProjects/agenty/media/receipt_files/2508020118133218_BzSm5Ds.pdf
[2025-08-15 17:47:02] INFO in chatbot.receipt_processor: File size: 655865 bytes
[2025-08-15 17:47:02] ERROR in chatbot.receipt_processor: ‚ùå CRITICAL ERROR during receipt processing for ID 13: 'str' object has no attribute 'name'
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 389, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/retry.py", line 105, in call_with_retry
    return do()
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 390, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 803, in _connect
    raise err
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 787, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 127, in reconnect_on_error
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 177, in _consume_from
    self._pubsub.subscribe(key)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 1030, in subscribe
    ret_val = self.execute_command("SUBSCRIBE", *new_channels.keys())
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 860, in execute_command
    self.connection = self.connection_pool.get_connection()
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/utils.py", line 195, in wrapper
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 1533, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 380, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 397, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 389, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/retry.py", line 105, in call_with_retry
    return do()
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 390, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 803, in _connect
    raise err
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 787, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/connection.py", line 472, in _reraise_as_library_errors
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/base.py", line 929, in send_task
    self.backend.on_task_call(P, task_id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 378, in on_task_call
    self.result_consumer.consume_from(task_id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 169, in consume_from
    return self.start(task_id)
           ~~~~~~~~~~^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 147, in start
    self._consume_from(initial_task_id)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 176, in _consume_from
    with self.reconnect_on_error():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 130, in reconnect_on_error
    self._ensure(self._reconnect_pubsub, ())
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 389, in ensure
    return retry_over_time(
        fun, self.connection_errors, args, {},
        partial(self.on_connection_error, max_retries),
        **retry_policy)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/utils/functional.py", line 318, in retry_over_time
    return fun(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 106, in _reconnect_pubsub
    metas = self.backend.client.mget(self.subscribed_to)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/commands/core.py", line 1994, in mget
    return self.execute_command("MGET", *args, **options)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 621, in execute_command
    return self._execute_command(*args, **options)
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 627, in _execute_command
    conn = self.connection or pool.get_connection()
                              ~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/utils.py", line 195, in wrapper
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 1533, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 380, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 397, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 489, in thread_handler
    raise exc_info[1]
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 489, in thread_handler
    raise exc_info[1]
  File "/home/marcin/PycharmProjects/agenty/chatbot/services/receipt_service.py", line 74, in start_processing
    task_result = process_receipt_task.delay(receipt_id)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/task.py", line 444, in delay
    return self.apply_async(args, kwargs)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/task.py", line 601, in apply_async
    return app.send_task(
           ~~~~~~~~~~~~~^
        self.name, args, kwargs, task_id=task_id, producer=producer,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        **options
        ^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/base.py", line 927, in send_task
    with P.connection._reraise_as_library_errors():
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/connection.py", line 476, in _reraise_as_library_errors
    raise ConnectionError(str(exc)) from exc
kombu.exceptions.OperationalError: Error 111 connecting to localhost:6379. Connection refused.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 200, in process_receipt
    file_type = get_file_type(file_path)
  File "/home/marcin/PycharmProjects/agenty/chatbot/validators.py", line 53, in get_file_type
    file_extension = os.path.splitext(file.name)[1].lower()
                                      ^^^^^^^^^
AttributeError: 'str' object has no attribute 'name'
[2025-08-15 17:47:02] INFO in chatbot.receipt_processor: Marked receipt 13 as error in database
[2025-08-15 17:47:02] INFO in chatbot.services.receipt_service: ‚úÖ Completed synchronous processing for receipt 13
[2025-08-15 17:47:02] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 13
[2025-08-15 17:47:45] INFO in chatbot.services.receipt_service: Created receipt processing record: 14
[2025-08-15 17:47:45] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 14
[2025-08-15 17:47:45] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 14 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-15 17:47:45] INFO in chatbot.services.receipt_service: Marking receipt 14 as processing...
[2025-08-15 17:47:45] DEBUG in chatbot.services.receipt_service: Receipt 14 status updated to: ocr_in_progress
[2025-08-15 17:47:45] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 14
[2025-08-15 17:47:45] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-15 17:48:04] WARNING in chatbot.services.receipt_service: ‚ö†Ô∏è Celery task failed for receipt 14: Error 111 connecting to localhost:6379. Connection refused.
[2025-08-15 17:48:04] INFO in chatbot.services.receipt_service: Falling back to synchronous processing for receipt 14
[2025-08-15 17:48:04] DEBUG in chatbot.services.receipt_service: Receipt processor imported successfully
[2025-08-15 17:48:04] INFO in chatbot.services.receipt_service: Starting synchronous OCR processing for receipt 14
[2025-08-15 17:48:04] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 14
[2025-08-15 17:48:04] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-15 17:48:04] INFO in chatbot.receipt_processor: ‚úÖ Found receipt record: 14, current status: ocr_in_progress
[2025-08-15 17:48:04] INFO in chatbot.receipt_processor: Updating receipt 14 status to 'ocr_in_progress'
[2025-08-15 17:48:04] DEBUG in chatbot.receipt_processor: Receipt 14 status updated successfully
[2025-08-15 17:48:04] INFO in chatbot.receipt_processor: Processing file: /home/marcin/PycharmProjects/agenty/media/receipt_files/2508020118133218_M79Vh6J.pdf
[2025-08-15 17:48:04] INFO in chatbot.receipt_processor: File size: 655865 bytes
[2025-08-15 17:48:04] ERROR in chatbot.receipt_processor: ‚ùå CRITICAL ERROR during receipt processing for ID 14: 'str' object has no attribute 'name'
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 389, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/retry.py", line 105, in call_with_retry
    return do()
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 390, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 803, in _connect
    raise err
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 787, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 127, in reconnect_on_error
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 177, in _consume_from
    self._pubsub.subscribe(key)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 1030, in subscribe
    ret_val = self.execute_command("SUBSCRIBE", *new_channels.keys())
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 860, in execute_command
    self.connection = self.connection_pool.get_connection()
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/utils.py", line 195, in wrapper
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 1533, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 380, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 397, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 389, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/retry.py", line 105, in call_with_retry
    return do()
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 390, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 803, in _connect
    raise err
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 787, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/connection.py", line 472, in _reraise_as_library_errors
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/base.py", line 929, in send_task
    self.backend.on_task_call(P, task_id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 378, in on_task_call
    self.result_consumer.consume_from(task_id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 169, in consume_from
    return self.start(task_id)
           ~~~~~~~~~~^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 147, in start
    self._consume_from(initial_task_id)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 176, in _consume_from
    with self.reconnect_on_error():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 130, in reconnect_on_error
    self._ensure(self._reconnect_pubsub, ())
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 389, in ensure
    return retry_over_time(
        fun, self.connection_errors, args, {},
        partial(self.on_connection_error, max_retries),
        **retry_policy)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/utils/functional.py", line 318, in retry_over_time
    return fun(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 106, in _reconnect_pubsub
    metas = self.backend.client.mget(self.subscribed_to)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/commands/core.py", line 1994, in mget
    return self.execute_command("MGET", *args, **options)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 621, in execute_command
    return self._execute_command(*args, **options)
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 627, in _execute_command
    conn = self.connection or pool.get_connection()
                              ~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/utils.py", line 195, in wrapper
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 1533, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 380, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 397, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 489, in thread_handler
    raise exc_info[1]
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 489, in thread_handler
    raise exc_info[1]
  File "/home/marcin/PycharmProjects/agenty/chatbot/services/receipt_service.py", line 74, in start_processing
    task_result = process_receipt_task.delay(receipt_id)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/task.py", line 444, in delay
    return self.apply_async(args, kwargs)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/task.py", line 601, in apply_async
    return app.send_task(
           ~~~~~~~~~~~~~^
        self.name, args, kwargs, task_id=task_id, producer=producer,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        **options
        ^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/base.py", line 927, in send_task
    with P.connection._reraise_as_library_errors():
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/connection.py", line 476, in _reraise_as_library_errors
    raise ConnectionError(str(exc)) from exc
kombu.exceptions.OperationalError: Error 111 connecting to localhost:6379. Connection refused.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 200, in process_receipt
    file_type = get_file_type(file_path)
  File "/home/marcin/PycharmProjects/agenty/chatbot/validators.py", line 53, in get_file_type
    file_extension = os.path.splitext(file.name)[1].lower()
                                      ^^^^^^^^^
AttributeError: 'str' object has no attribute 'name'
[2025-08-15 17:48:04] INFO in chatbot.receipt_processor: Marked receipt 14 as error in database
[2025-08-15 17:48:04] INFO in chatbot.services.receipt_service: ‚úÖ Completed synchronous processing for receipt 14
[2025-08-15 17:48:04] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 14
[2025-08-15 17:56:30] INFO in chatbot.services.receipt_service: Created receipt processing record: 15
[2025-08-15 17:56:30] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 15
[2025-08-15 17:56:30] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 15 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-15 17:56:30] INFO in chatbot.services.receipt_service: Marking receipt 15 as processing...
[2025-08-15 17:56:30] DEBUG in chatbot.services.receipt_service: Receipt 15 status updated to: ocr_in_progress
[2025-08-15 17:56:30] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 15
[2025-08-15 17:56:30] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-15 17:56:30] INFO in chatbot.services.receipt_service: ‚úÖ Celery task started successfully for receipt 15, task ID: bcd3e206-26c9-41d1-8a31-a804ca111b52
[2025-08-15 17:56:30] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 15
[2025-08-15 17:57:38] INFO in chatbot.tasks: Receipt 15 processed successfully by Celery task.
[2025-08-15 17:58:30] INFO in chatbot.services.receipt_service: Created receipt processing record: 16
[2025-08-15 17:58:30] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 16
[2025-08-15 17:58:30] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 16 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-15 17:58:30] INFO in chatbot.services.receipt_service: Marking receipt 16 as processing...
[2025-08-15 17:58:30] DEBUG in chatbot.services.receipt_service: Receipt 16 status updated to: ocr_in_progress
[2025-08-15 17:58:30] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 16
[2025-08-15 17:58:30] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-15 17:58:30] INFO in chatbot.services.receipt_service: ‚úÖ Celery task started successfully for receipt 16, task ID: fed3c6ea-60ce-4ba4-8118-9caa6b6e56d1
[2025-08-15 17:58:30] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 16
[2025-08-15 17:58:30] INFO in chatbot.tasks: Receipt 16 processed successfully by Celery task.
[2025-08-15 17:59:38] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 16
[2025-08-15 17:59:38] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-15 17:59:38] INFO in chatbot.receipt_processor: ‚úÖ Found receipt record: 16, current status: ocr_in_progress
[2025-08-15 17:59:38] INFO in chatbot.receipt_processor: Updating receipt 16 status to 'ocr_in_progress'
[2025-08-15 17:59:38] DEBUG in chatbot.receipt_processor: Receipt 16 status updated successfully
[2025-08-15 17:59:38] INFO in chatbot.receipt_processor: Processing file: /home/marcin/PycharmProjects/agenty/media/receipt_files/2508020118133218_kFdBItf.pdf
[2025-08-15 17:59:38] INFO in chatbot.receipt_processor: File size: 655865 bytes
[2025-08-15 17:59:38] INFO in chatbot.receipt_processor: Detected file type: pdf
[2025-08-15 17:59:38] INFO in chatbot.receipt_processor: üîç Starting text extraction from pdf file...
[2025-08-15 17:59:38] INFO in chatbot.receipt_processor: PDF page 0 has no text, using OCR
[2025-08-15 17:59:38] INFO in chatbot.receipt_processor: üì∑ Starting OCR text extraction from image: /tmp/tmpagh1tw_x.png
[2025-08-15 17:59:38] DEBUG in chatbot.receipt_processor: Initializing EasyOCR reader for image processing...
[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: EasyOCR detected 102 text regions
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 1: 'Biedronka' (confidence: 0.99)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 2: 'Codziennie niskie ceny' (confidence: 0.95)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 3: 'Sklep 3218 TARGOWA' (confidence: 0.57)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 4: 'Jeronimo Martins Polska 5. A.' (confidence: 0.78)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 5: 'ul. ≈ªniwna 5, 62-025 Kostrzyn' (confidence: 0.79)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 6: 'NIP 779-10-11-327' (confidence: 0.68)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 7: '02.08.2025 18:18' (confidence: 0.71)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 8: 'NIEFISKALNY' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 9: 'Nazwa' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 10: 'PTU' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 11: 'Ilo≈õƒá' (confidence: 0.63)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 12: 'Cena' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 13: 'Warto≈õƒá' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 14: 'PiwoOkoRadLimMiƒô0 ,' (confidence: 0.53)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 15: '1.000' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 16: '3,69' (confidence: 0.65)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 17: '3,69' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 18: 'PiwoOkoRadLimMiƒôO, :' (confidence: 0.50)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 19: '1.000' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 20: '3,69' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 21: '3,69' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 22: 'GranolaOchVitane5oo' (confidence: 0.77)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 23: '1.000' (confidence: 0.68)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 24: '11,99' (confidence: 0.98)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 25: '11,99' (confidence: 0.73)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 26: '≈ªelOldSpic4oomIMix' (confidence: 0.55)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 27: '1.000 x' (confidence: 0.94)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 28: '19,99' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 29: '19,99' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 30: 'Rabat' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 31: '-6,00' (confidence: 0.50)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 32: '13,99' (confidence: 0.90)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 33: '≈ªelOldSpic4OOmIMix' (confidence: 0.58)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 34: '1.000 x' (confidence: 0.92)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 35: '19,99' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 36: '19,99' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 37: 'Rabat' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 38: '+6,00' (confidence: 0.55)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 39: '13,99' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 40: '≈öwPodudzieKurczkg' (confidence: 0.98)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 41: '0.450' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 42: '13,49' (confidence: 0.96)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 43: '6,07' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 44: 'Par zFil z kur250g' (confidence: 0.92)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 45: '1.000 x' (confidence: 0.93)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 46: '5,99' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 47: '5,99' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 48: 'Rabat' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 49: '-2,20' (confidence: 0.58)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 50: '3,79' (confidence: 0.84)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 51: 'Par zFil z kur250g' (confidence: 0.92)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 52: '1.000' (confidence: 0.98)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 53: '5,99' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 54: '5,99' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 55: 'Rabat' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 56: '-2,20' (confidence: 0.84)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 57: '3,79' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 58: 'Sur√≥wka z pora450g' (confidence: 0.92)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 59: '1.000 x' (confidence: 0.97)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 60: '4,59' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 61: '4,59' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 62: 'JogurtGreckiFru 400g' (confidence: 0.78)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 63: '1.000' (confidence: 0.99)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 64: '2,85' (confidence: 0.73)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 65: '2,85' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 66: 'Rabat' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 67: '-0,36' (confidence: 0.65)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 68: '2,49' (confidence: 0.69)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 69: 'JogurtGreckiFru 400g' (confidence: 0.78)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 70: '1.000 x' (confidence: 0.83)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 71: '2,85' (confidence: 0.87)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 72: '2,85' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 73: 'Rabat' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 74: '-0,36' (confidence: 0.79)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 75: '2,49' (confidence: 0.70)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 76: 'JogurtGreckiFru 400g' (confidence: 0.81)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 77: '1.000' (confidence: 0.98)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 78: '2,85' (confidence: 0.99)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 79: '2,85' (confidence: 0.98)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 80: 'Rabat' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 81: '-0,36' (confidence: 0.71)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 82: '2,49' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 83: 'Win' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 84: 'op 500g' (confidence: 0.91)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 85: '1.000' (confidence: 0.87)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 86: '9,99' (confidence: 0.99)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 87: '9,99' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 88: 'Rabat' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 89: '-5,00' (confidence: 0.77)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 90: '4,99' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 91: 'Pizza z kurcz' (confidence: 0.92)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 92: '1.000' (confidence: 0.60)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 93: '12,79' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 94: '12,79' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 95: 'GulaszNS4OOg' (confidence: 0.90)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 96: '1.000' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 97: '11,99' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 98: '11,99' (confidence: 0.80)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 99: '3218/13/118/02.08.2025' (confidence: 0.68)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 100: 'Strona 1 z 2' (confidence: 0.98)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 101: 'bezp' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 102: '400g' (confidence: 0.63)
[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: ‚úÖ OCR extraction completed. Total text length: 908 characters
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: OCR extracted text: Biedronka Codziennie niskie ceny Sklep 3218 TARGOWA Jeronimo Martins Polska 5. A. ul. ≈ªniwna 5, 62-025 Kostrzyn NIP 779-10-11-327 02.08.2025 18:18 NIEFISKALNY Nazwa PTU Ilo≈õƒá Cena Warto≈õƒá PiwoOkoRadLimMiƒô0 , 1.000 3,69 3,69 PiwoOkoRadLimMiƒôO, : 1.000 3,69 3,69 GranolaOchVitane5oo 1.000 11,99 11,99 ≈ªelOldSpic4oomIMix 1.000 x 19,99 19,99 Rabat -6,00 13,99 ≈ªelOldSpic4OOmIMix 1.000 x 19,99 19,99 Rabat +6,00 13,99 ≈öwPodudzieKurczkg 0.450 13,49 6,07 Par zFil z kur250g 1.000 x 5,99 5,99 Rabat -2,20 3,79 Par zFil z kur250g 1.000 5,99 5,99 Rabat -2,20 3,79 Sur√≥wka z pora450g 1.000 x 4,59 4,59 JogurtGreckiFru 400g 1.000 2,85 2,85 Rabat -0,36 2,49 JogurtGreckiFru 400g 1.000 x 2,85 2,85 Rabat -0,36 2,49 JogurtGreckiFru 400g 1.000 2,85 2,85 Rabat -0,36 2,49 Win op 500g 1.000 9,99 9,99 Rabat -5,00 4,99 Pizza z kurcz 1.000 12,79 12,79 GulaszNS4OOg 1.000 11,99 11,99 3218/13/118/02.08.2025 Strona 1 z 2 bezp 400g
[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: PDF page 1 has no text, using OCR
[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: üì∑ Starting OCR text extraction from image: /tmp/tmpea17dz25.png
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Initializing EasyOCR reader for image processing...
[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: EasyOCR detected 20 text regions
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 1: 'Sprzeda≈º opodatkowana C' (confidence: 0.64)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 2: '74,85' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 3: 'PTU C 5%' (confidence: 0.84)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 4: '3,56' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 5: 'Sprzeda≈º opodatkowana' (confidence: 0.68)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 6: '27,98' (confidence: 0.99)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 7: 'PTU A 23%' (confidence: 0.79)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 8: '5,23' (confidence: 0.82)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 9: 'Suma PTU' (confidence: 0.92)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 10: '8,79' (confidence: 0.99)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 11: 'Suma PLN' (confidence: 0.87)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 12: '102,83' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 13: 'Kasa 13 Kasjer' (confidence: 0.97)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 14: '1000032180118204013106' (confidence: 0.94)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 15: 'Inna BLIK' (confidence: 0.98)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 16: '102,83' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 17: 'Numer transakcji' (confidence: 0.90)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 18: '118' (confidence: 1.00)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 19: '3218/13/118/02.08.2025' (confidence: 0.68)
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Region 20: 'Strona 2 z 2' (confidence: 0.99)
[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: ‚úÖ OCR extraction completed. Total text length: 228 characters
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: OCR extracted text: Sprzeda≈º opodatkowana C 74,85 PTU C 5% 3,56 Sprzeda≈º opodatkowana 27,98 PTU A 23% 5,23 Suma PTU 8,79 Suma PLN 102,83 Kasa 13 Kasjer 1000032180118204013106 Inna BLIK 102,83 Numer transakcji 118 3218/13/118/02.08.2025 Strona 2 z 2
[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: PDF text extracted: Biedronka Codziennie niskie ceny Sklep 3218 TARGOWA Jeronimo Martins Polska 5. A. ul. ≈ªniwna 5, 62-025 Kostrzyn NIP 779-10-11-327 02.08.2025 18:18 NIEFISKALNY Nazwa PTU Ilo≈õƒá Cena Warto≈õƒá PiwoOkoRadLimMiƒô0 , 1.000 3,69 3,69 PiwoOkoRadLimMiƒôO, : 1.000 3,69 3,69 GranolaOchVitane5oo 1.000 11,99 11,99 ≈ªelOldSpic4oomIMix 1.000 x 19,99 19,99 Rabat -6,00 13,99 ≈ªelOldSpic4OOmIMix 1.000 x 19,99 19,99 Rabat +6,00 13,99 ≈öwPodudzieKurczkg 0.450 13,49 6,07 Par zFil z kur250g 1.000 x 5,99 5,99 Rabat -2,20 3,79 Par zFil z kur250g 1.000 5,99 5,99 Rabat -2,20 3,79 Sur√≥wka z pora450g 1.000 x 4,59 4,59 JogurtGreckiFru 400g 1.000 2,85 2,85 Rabat -0,36 2,49 JogurtGreckiFru 400g 1.000 x 2,85 2,85 Rabat -0,36 2,49 JogurtGreckiFru 400g 1.000 2,85 2,85 Rabat -0,36 2,49 Win op 500g 1.000 9,99 9,99 Rabat -5,00 4,99 Pizza z kurcz 1.000 12,79 12,79 GulaszNS4OOg 1.000 11,99 11,99 3218/13/118/02.08.2025 Strona 1 z 2 bezp 400g
Sprzeda≈º opodatkowana C 74,85 PTU C 5% 3,56 Sprzeda≈º opodatkowana 27,98 PTU A 23% 5,23 Suma PTU 8,79 Suma PLN 102,83 Kasa 13 Kasjer 1000032180118204013106 Inna BLIK 102,83 Numer transakcji 118 3218/13/118/02.08.2025 Strona 2 z 2

[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: ‚úÖ OCR text extraction completed. Extracted 1137 characters
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Extracted text preview: Biedronka Codziennie niskie ceny Sklep 3218 TARGOWA Jeronimo Martins Polska 5. A. ul. ≈ªniwna 5, 62-025 Kostrzyn NIP 779-10-11-327 02.08.2025 18:18 NIEFISKALNY Nazwa PTU Ilo≈õƒá Cena Warto≈õƒá PiwoOkoRadLi...
[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: Receipt 16 status updated to 'ocr_done'
[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction for receipt 16
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Receipt 16 status updated to 'llm_in_progress'
[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction...
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Input text length: 1137 characters
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Input text preview: Biedronka Codziennie niskie ceny Sklep 3218 TARGOWA Jeronimo Martins Polska 5. A. ul. ≈ªniwna 5, 62-025 Kostrzyn NIP 779-10-11-327 02.08.2025 18:18 NIEFISKALNY Nazwa PTU Ilo≈õƒá Cena Warto≈õƒá PiwoOkoRadLimMiƒô0 , 1.000 3,69 3,69 PiwoOkoRadLimMiƒôO, : 1.000 3,69 3,69 GranolaOchVitane5oo 1.000 11,99 11,99 ≈ª...
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Prepared LLM prompt (length: 807 chars)
[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: Sending request to LLM model...
[2025-08-15 17:59:40] DEBUG in chatbot.receipt_processor: Initializing OllamaAgent for product extraction...
[2025-08-15 17:59:40] INFO in chatbot.receipt_processor: Calling LLM to process receipt text...
[2025-08-15 18:02:57] INFO in chatbot.services.receipt_service: Created receipt processing record: 17
[2025-08-15 18:02:57] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 17
[2025-08-15 18:02:57] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 17 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-15 18:02:57] INFO in chatbot.services.receipt_service: Marking receipt 17 as processing...
[2025-08-15 18:02:57] DEBUG in chatbot.services.receipt_service: Receipt 17 status updated to: ocr_in_progress
[2025-08-15 18:02:57] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 17
[2025-08-15 18:02:57] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-15 18:02:57] INFO in chatbot.services.receipt_service: ‚úÖ Celery task started successfully for receipt 17, task ID: af0745aa-e10c-4f8d-ac2e-025c21a66316
[2025-08-15 18:02:57] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 17
[2025-08-15 18:02:57] INFO in chatbot.tasks: Receipt 17 processed successfully by Celery task.
[2025-08-15 20:20:23] INFO in chatbot.services.receipt_service: Starting parsing for receipt 2: 71 characters
[2025-08-15 20:20:23] INFO in chatbot.services.receipt_service: Parsing completed for receipt 2: 2 products extracted
[2025-08-15 20:20:23] INFO in chatbot.services.receipt_service: Starting product matching for receipt 2: 2 products
[2025-08-15 20:20:23] WARNING in chatbot.services.receipt_service: Inventory update failed for receipt 2: Receipt 2 is not completed (status: matching)
[2025-08-15 20:20:23] INFO in chatbot.services.receipt_service: Matching completed for receipt 2: 2 line items created
[2025-08-15 20:20:23] ERROR in chatbot.services.receipt_service: Receipt 3 has no valid OCR text data
[2025-08-15 20:20:23] INFO in chatbot.services.receipt_service: Starting parsing for receipt 4: 83 characters
[2025-08-15 20:20:23] INFO in chatbot.services.receipt_service: Parsing completed for receipt 4: 2 products extracted
[2025-08-15 20:20:23] INFO in chatbot.services.receipt_service: Starting product matching for receipt 4: 2 products
[2025-08-15 20:20:23] WARNING in chatbot.services.receipt_service: Inventory update failed for receipt 4: Receipt 4 is not completed (status: matching)
[2025-08-15 20:20:23] INFO in chatbot.services.receipt_service: Matching completed for receipt 4: 2 line items created
[2025-08-15 20:20:24] INFO in chatbot.services.receipt_service: Starting parsing for receipt 5: 285 characters
[2025-08-15 20:20:24] INFO in chatbot.services.receipt_service: Parsing completed for receipt 5: 3 products extracted
[2025-08-15 20:20:24] INFO in chatbot.services.receipt_service: Starting product matching for receipt 5: 3 products
[2025-08-15 20:20:24] WARNING in chatbot.services.receipt_service: Inventory update failed for receipt 5: Receipt 5 is not completed (status: matching)
[2025-08-15 20:20:24] INFO in chatbot.services.receipt_service: Matching completed for receipt 5: 3 line items created
[2025-08-15 20:22:51] INFO in chatbot.services.receipt_service: Starting parsing for receipt 6: 71 characters
[2025-08-15 20:22:51] INFO in chatbot.services.receipt_service: Parsing completed for receipt 6: 2 products extracted
[2025-08-15 20:22:51] INFO in chatbot.services.receipt_service: Starting product matching for receipt 6: 2 products
[2025-08-15 20:22:51] WARNING in chatbot.services.receipt_service: Inventory update failed for receipt 6: Receipt 6 is not completed (status: matching)
[2025-08-15 20:22:51] INFO in chatbot.services.receipt_service: Matching completed for receipt 6: 2 line items created
[2025-08-15 20:22:52] ERROR in chatbot.services.receipt_service: Receipt 7 has no valid OCR text data
[2025-08-15 20:22:52] INFO in chatbot.services.receipt_service: Starting parsing for receipt 8: 83 characters
[2025-08-15 20:22:52] INFO in chatbot.services.receipt_service: Parsing completed for receipt 8: 2 products extracted
[2025-08-15 20:22:52] INFO in chatbot.services.receipt_service: Starting product matching for receipt 8: 2 products
[2025-08-15 20:22:52] WARNING in chatbot.services.receipt_service: Inventory update failed for receipt 8: Receipt 8 is not completed (status: matching)
[2025-08-15 20:22:52] INFO in chatbot.services.receipt_service: Matching completed for receipt 8: 2 line items created
[2025-08-15 20:22:52] INFO in chatbot.services.receipt_service: Starting parsing for receipt 9: 285 characters
[2025-08-15 20:22:52] INFO in chatbot.services.receipt_service: Parsing completed for receipt 9: 3 products extracted
[2025-08-15 20:22:52] INFO in chatbot.services.receipt_service: Starting product matching for receipt 9: 3 products
[2025-08-15 20:22:52] WARNING in chatbot.services.receipt_service: Inventory update failed for receipt 9: Receipt 9 is not completed (status: matching)
[2025-08-15 20:22:52] INFO in chatbot.services.receipt_service: Matching completed for receipt 9: 3 line items created
[2025-08-15 20:23:35] INFO in chatbot.services.receipt_service: Starting parsing for receipt 10: 71 characters
[2025-08-15 20:23:35] INFO in chatbot.services.receipt_service: Parsing completed for receipt 10: 2 products extracted
[2025-08-15 20:23:35] INFO in chatbot.services.receipt_service: Starting product matching for receipt 10: 2 products
[2025-08-15 20:23:35] WARNING in chatbot.services.receipt_service: Inventory update failed for receipt 10: Receipt 10 is not completed (status: matching)
[2025-08-15 20:23:35] INFO in chatbot.services.receipt_service: Matching completed for receipt 10: 2 line items created
[2025-08-15 20:23:35] ERROR in chatbot.services.receipt_service: Receipt 11 has no valid OCR text data
[2025-08-15 20:23:35] INFO in chatbot.services.receipt_service: Starting parsing for receipt 12: 83 characters
[2025-08-15 20:23:35] INFO in chatbot.services.receipt_service: Parsing completed for receipt 12: 2 products extracted
[2025-08-15 20:23:35] INFO in chatbot.services.receipt_service: Starting product matching for receipt 12: 2 products
[2025-08-15 20:23:35] WARNING in chatbot.services.receipt_service: Inventory update failed for receipt 12: Receipt 12 is not completed (status: matching)
[2025-08-15 20:23:35] INFO in chatbot.services.receipt_service: Matching completed for receipt 12: 2 line items created
[2025-08-15 20:23:35] INFO in chatbot.services.receipt_service: Starting parsing for receipt 13: 285 characters
[2025-08-15 20:23:35] INFO in chatbot.services.receipt_service: Parsing completed for receipt 13: 3 products extracted
[2025-08-15 20:23:35] INFO in chatbot.services.receipt_service: Starting product matching for receipt 13: 3 products
[2025-08-15 20:23:35] WARNING in chatbot.services.receipt_service: Inventory update failed for receipt 13: Receipt 13 is not completed (status: matching)
[2025-08-15 20:23:35] INFO in chatbot.services.receipt_service: Matching completed for receipt 13: 3 line items created
[2025-08-15 20:24:49] INFO in chatbot.services.receipt_service: Starting parsing for receipt 14: 71 characters
[2025-08-15 20:24:50] INFO in chatbot.services.receipt_service: Parsing completed for receipt 14: 2 products extracted
[2025-08-15 20:24:50] INFO in chatbot.services.receipt_service: Starting product matching for receipt 14: 2 products
[2025-08-15 20:24:50] WARNING in chatbot.services.receipt_service: Inventory update failed for receipt 14: Receipt 14 is not completed (status: matching)
[2025-08-15 20:24:50] INFO in chatbot.services.receipt_service: Matching completed for receipt 14: 2 line items created
[2025-08-15 20:24:50] ERROR in chatbot.services.receipt_service: Receipt 15 has no valid OCR text data
[2025-08-15 20:24:50] INFO in chatbot.services.receipt_service: Starting parsing for receipt 16: 83 characters
[2025-08-15 20:24:50] INFO in chatbot.services.receipt_service: Parsing completed for receipt 16: 2 products extracted
[2025-08-15 20:24:50] INFO in chatbot.services.receipt_service: Starting product matching for receipt 16: 2 products
[2025-08-15 20:24:50] WARNING in chatbot.services.receipt_service: Inventory update failed for receipt 16: Receipt 16 is not completed (status: matching)
[2025-08-15 20:24:50] INFO in chatbot.services.receipt_service: Matching completed for receipt 16: 2 line items created
[2025-08-15 20:24:50] INFO in chatbot.services.receipt_service: Starting parsing for receipt 17: 285 characters
[2025-08-15 20:24:50] INFO in chatbot.services.receipt_service: Parsing completed for receipt 17: 3 products extracted
[2025-08-15 20:24:50] INFO in chatbot.services.receipt_service: Starting product matching for receipt 17: 3 products
[2025-08-15 20:24:50] WARNING in chatbot.services.receipt_service: Inventory update failed for receipt 17: Receipt 17 is not completed (status: matching)
[2025-08-15 20:24:50] INFO in chatbot.services.receipt_service: Matching completed for receipt 17: 3 line items created
[2025-08-15 20:29:48] INFO in chatbot.services.receipt_service: Created receipt processing record: 18
[2025-08-15 20:29:48] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 18
[2025-08-15 20:29:48] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 18 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-15 20:29:48] INFO in chatbot.services.receipt_service: Marking receipt 18 as processing...
[2025-08-15 20:29:48] DEBUG in chatbot.services.receipt_service: Receipt 18 status updated to: ocr_in_progress
[2025-08-15 20:29:48] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 18
[2025-08-15 20:29:48] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-15 20:29:48] INFO in chatbot.services.receipt_service: ‚úÖ Celery task started successfully for receipt 18, task ID: 4795598a-fba5-44ba-afc6-685d43fd04ba
[2025-08-15 20:29:48] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 18
[2025-08-15 20:29:48] INFO in chatbot.tasks: Receipt 18 processed successfully by Celery task.
[2025-08-16 20:51:38] INFO in chatbot.services.receipt_service: Created receipt processing record: 1
[2025-08-16 20:51:38] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 1
[2025-08-16 20:51:38] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 1 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-16 20:51:38] INFO in chatbot.services.receipt_service: Marking receipt 1 as processing...
[2025-08-16 20:51:38] DEBUG in chatbot.services.receipt_service: Receipt 1 status updated to: ocr_in_progress
[2025-08-16 20:51:38] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 1
[2025-08-16 20:51:42] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-16 20:52:01] WARNING in chatbot.services.receipt_service: ‚ö†Ô∏è Celery task failed for receipt 1: Error 111 connecting to localhost:6379. Connection refused.
[2025-08-16 20:52:01] INFO in chatbot.services.receipt_service: Falling back to synchronous processing for receipt 1
[2025-08-16 20:52:01] DEBUG in chatbot.services.receipt_service: Receipt processor imported successfully
[2025-08-16 20:52:01] INFO in chatbot.services.receipt_service: Starting synchronous OCR processing for receipt 1
[2025-08-16 20:52:01] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 1
[2025-08-16 20:52:01] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-16 20:52:01] ERROR in chatbot.receipt_processor: ‚ùå CRITICAL ERROR during receipt processing for ID 1: database table is locked: chatbot_receiptprocessing
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 389, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/retry.py", line 105, in call_with_retry
    return do()
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 390, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 803, in _connect
    raise err
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 787, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 127, in reconnect_on_error
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 177, in _consume_from
    self._pubsub.subscribe(key)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 1030, in subscribe
    ret_val = self.execute_command("SUBSCRIBE", *new_channels.keys())
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 860, in execute_command
    self.connection = self.connection_pool.get_connection()
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/utils.py", line 195, in wrapper
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 1533, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 380, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 397, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 389, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/retry.py", line 105, in call_with_retry
    return do()
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 390, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 803, in _connect
    raise err
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 787, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/connection.py", line 472, in _reraise_as_library_errors
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/base.py", line 929, in send_task
    self.backend.on_task_call(P, task_id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 378, in on_task_call
    self.result_consumer.consume_from(task_id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 169, in consume_from
    return self.start(task_id)
           ~~~~~~~~~~^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 147, in start
    self._consume_from(initial_task_id)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 176, in _consume_from
    with self.reconnect_on_error():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 130, in reconnect_on_error
    self._ensure(self._reconnect_pubsub, ())
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 389, in ensure
    return retry_over_time(
        fun, self.connection_errors, args, {},
        partial(self.on_connection_error, max_retries),
        **retry_policy)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/utils/functional.py", line 318, in retry_over_time
    return fun(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 106, in _reconnect_pubsub
    metas = self.backend.client.mget(self.subscribed_to)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/commands/core.py", line 1994, in mget
    return self.execute_command("MGET", *args, **options)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 621, in execute_command
    return self._execute_command(*args, **options)
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 627, in _execute_command
    conn = self.connection or pool.get_connection()
                              ~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/utils.py", line 195, in wrapper
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 1533, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 380, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 397, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 489, in thread_handler
    raise exc_info[1]
  File "/home/marcin/PycharmProjects/agenty/chatbot/services/receipt_service.py", line 92, in start_processing
    task_result = process_receipt_task.delay(receipt_id)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/task.py", line 444, in delay
    return self.apply_async(args, kwargs)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/task.py", line 601, in apply_async
    return app.send_task(
           ~~~~~~~~~~~~~^
        self.name, args, kwargs, task_id=task_id, producer=producer,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        **options
        ^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/base.py", line 927, in send_task
    with P.connection._reraise_as_library_errors():
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/connection.py", line 476, in _reraise_as_library_errors
    raise ConnectionError(str(exc)) from exc
kombu.exceptions.OperationalError: Error 111 connecting to localhost:6379. Connection refused.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
sqlite3.OperationalError: database table is locked: chatbot_receiptprocessing

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 196, in process_receipt
    receipt_record = await sync_to_async(ReceiptProcessing.objects.get)(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        id=receipt_processing_id
        ^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 439, in __call__
    ret = await asyncio.shield(exec_coro)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 491, in thread_handler
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 629, in get
    num = len(clone)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 366, in __len__
    self._fetch_all()
    ~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1949, in _fetch_all
    self._result_cache = list(self._iterable_class(self))
                         ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 91, in __iter__
    results = compiler.execute_sql(
        chunked_fetch=self.chunked_fetch, chunk_size=self.chunk_size
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        sql, params, many=False, executor=self._execute
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
django.db.utils.OperationalError: database table is locked: chatbot_receiptprocessing
[2025-08-16 20:52:01] INFO in chatbot.services.receipt_service: ‚úÖ Completed synchronous processing for receipt 1
[2025-08-16 20:52:01] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 1
[2025-08-16 20:52:01] INFO in chatbot.services.receipt_service: Created receipt processing record: 1
[2025-08-16 20:52:01] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 1
[2025-08-16 20:52:01] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 1 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-16 20:52:01] INFO in chatbot.services.receipt_service: Marking receipt 1 as processing...
[2025-08-16 20:52:01] DEBUG in chatbot.services.receipt_service: Receipt 1 status updated to: ocr_in_progress
[2025-08-16 20:52:01] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 1
[2025-08-16 20:52:01] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-16 20:52:20] WARNING in chatbot.services.receipt_service: ‚ö†Ô∏è Celery task failed for receipt 1: Error 111 connecting to localhost:6379. Connection refused.
[2025-08-16 20:52:20] INFO in chatbot.services.receipt_service: Falling back to synchronous processing for receipt 1
[2025-08-16 20:52:20] DEBUG in chatbot.services.receipt_service: Receipt processor imported successfully
[2025-08-16 20:52:20] INFO in chatbot.services.receipt_service: Starting synchronous OCR processing for receipt 1
[2025-08-16 20:52:20] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 1
[2025-08-16 20:52:20] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-16 20:52:20] ERROR in chatbot.receipt_processor: ‚ùå CRITICAL ERROR during receipt processing for ID 1: database table is locked: chatbot_receiptprocessing
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 389, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/retry.py", line 105, in call_with_retry
    return do()
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 390, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 803, in _connect
    raise err
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 787, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 127, in reconnect_on_error
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 177, in _consume_from
    self._pubsub.subscribe(key)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 1030, in subscribe
    ret_val = self.execute_command("SUBSCRIBE", *new_channels.keys())
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 860, in execute_command
    self.connection = self.connection_pool.get_connection()
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/utils.py", line 195, in wrapper
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 1533, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 380, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 397, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 389, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/retry.py", line 105, in call_with_retry
    return do()
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 390, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 803, in _connect
    raise err
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 787, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/connection.py", line 472, in _reraise_as_library_errors
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/base.py", line 929, in send_task
    self.backend.on_task_call(P, task_id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 378, in on_task_call
    self.result_consumer.consume_from(task_id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 169, in consume_from
    return self.start(task_id)
           ~~~~~~~~~~^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 147, in start
    self._consume_from(initial_task_id)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 176, in _consume_from
    with self.reconnect_on_error():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 130, in reconnect_on_error
    self._ensure(self._reconnect_pubsub, ())
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 389, in ensure
    return retry_over_time(
        fun, self.connection_errors, args, {},
        partial(self.on_connection_error, max_retries),
        **retry_policy)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/utils/functional.py", line 318, in retry_over_time
    return fun(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 106, in _reconnect_pubsub
    metas = self.backend.client.mget(self.subscribed_to)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/commands/core.py", line 1994, in mget
    return self.execute_command("MGET", *args, **options)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 621, in execute_command
    return self._execute_command(*args, **options)
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 627, in _execute_command
    conn = self.connection or pool.get_connection()
                              ~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/utils.py", line 195, in wrapper
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 1533, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 380, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 397, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 489, in thread_handler
    raise exc_info[1]
  File "/home/marcin/PycharmProjects/agenty/chatbot/services/receipt_service.py", line 92, in start_processing
    task_result = process_receipt_task.delay(receipt_id)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/task.py", line 444, in delay
    return self.apply_async(args, kwargs)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/task.py", line 601, in apply_async
    return app.send_task(
           ~~~~~~~~~~~~~^
        self.name, args, kwargs, task_id=task_id, producer=producer,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        **options
        ^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/base.py", line 927, in send_task
    with P.connection._reraise_as_library_errors():
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/connection.py", line 476, in _reraise_as_library_errors
    raise ConnectionError(str(exc)) from exc
kombu.exceptions.OperationalError: Error 111 connecting to localhost:6379. Connection refused.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
sqlite3.OperationalError: database table is locked: chatbot_receiptprocessing

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 196, in process_receipt
    receipt_record = await sync_to_async(ReceiptProcessing.objects.get)(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        id=receipt_processing_id
        ^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 439, in __call__
    ret = await asyncio.shield(exec_coro)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 491, in thread_handler
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 629, in get
    num = len(clone)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 366, in __len__
    self._fetch_all()
    ~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1949, in _fetch_all
    self._result_cache = list(self._iterable_class(self))
                         ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 91, in __iter__
    results = compiler.execute_sql(
        chunked_fetch=self.chunked_fetch, chunk_size=self.chunk_size
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        sql, params, many=False, executor=self._execute
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
django.db.utils.OperationalError: database table is locked: chatbot_receiptprocessing
[2025-08-16 20:52:20] INFO in chatbot.services.receipt_service: ‚úÖ Completed synchronous processing for receipt 1
[2025-08-16 20:52:20] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 1
[2025-08-16 20:52:20] INFO in chatbot.services.receipt_service: Created receipt processing record: 1
[2025-08-16 20:52:20] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 1
[2025-08-16 20:52:20] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 1 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-16 20:52:20] INFO in chatbot.services.receipt_service: Marking receipt 1 as processing...
[2025-08-16 20:52:20] DEBUG in chatbot.services.receipt_service: Receipt 1 status updated to: ocr_in_progress
[2025-08-16 20:52:20] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 1
[2025-08-16 20:52:20] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-16 20:52:39] WARNING in chatbot.services.receipt_service: ‚ö†Ô∏è Celery task failed for receipt 1: Error 111 connecting to localhost:6379. Connection refused.
[2025-08-16 20:52:39] INFO in chatbot.services.receipt_service: Falling back to synchronous processing for receipt 1
[2025-08-16 20:52:39] DEBUG in chatbot.services.receipt_service: Receipt processor imported successfully
[2025-08-16 20:52:39] INFO in chatbot.services.receipt_service: Starting synchronous OCR processing for receipt 1
[2025-08-16 20:52:39] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 1
[2025-08-16 20:52:39] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-16 20:52:39] ERROR in chatbot.receipt_processor: ‚ùå CRITICAL ERROR during receipt processing for ID 1: database table is locked: chatbot_receiptprocessing
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 389, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/retry.py", line 105, in call_with_retry
    return do()
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 390, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 803, in _connect
    raise err
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 787, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 127, in reconnect_on_error
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 177, in _consume_from
    self._pubsub.subscribe(key)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 1030, in subscribe
    ret_val = self.execute_command("SUBSCRIBE", *new_channels.keys())
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 860, in execute_command
    self.connection = self.connection_pool.get_connection()
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/utils.py", line 195, in wrapper
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 1533, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 380, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 397, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 389, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/retry.py", line 105, in call_with_retry
    return do()
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 390, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 803, in _connect
    raise err
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 787, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/connection.py", line 472, in _reraise_as_library_errors
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/base.py", line 929, in send_task
    self.backend.on_task_call(P, task_id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 378, in on_task_call
    self.result_consumer.consume_from(task_id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 169, in consume_from
    return self.start(task_id)
           ~~~~~~~~~~^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 147, in start
    self._consume_from(initial_task_id)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 176, in _consume_from
    with self.reconnect_on_error():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 130, in reconnect_on_error
    self._ensure(self._reconnect_pubsub, ())
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 389, in ensure
    return retry_over_time(
        fun, self.connection_errors, args, {},
        partial(self.on_connection_error, max_retries),
        **retry_policy)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/utils/functional.py", line 318, in retry_over_time
    return fun(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 106, in _reconnect_pubsub
    metas = self.backend.client.mget(self.subscribed_to)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/commands/core.py", line 1994, in mget
    return self.execute_command("MGET", *args, **options)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 621, in execute_command
    return self._execute_command(*args, **options)
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 627, in _execute_command
    conn = self.connection or pool.get_connection()
                              ~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/utils.py", line 195, in wrapper
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 1533, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 380, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 397, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 489, in thread_handler
    raise exc_info[1]
  File "/home/marcin/PycharmProjects/agenty/chatbot/services/receipt_service.py", line 92, in start_processing
    task_result = process_receipt_task.delay(receipt_id)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/task.py", line 444, in delay
    return self.apply_async(args, kwargs)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/task.py", line 601, in apply_async
    return app.send_task(
           ~~~~~~~~~~~~~^
        self.name, args, kwargs, task_id=task_id, producer=producer,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        **options
        ^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/base.py", line 927, in send_task
    with P.connection._reraise_as_library_errors():
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/connection.py", line 476, in _reraise_as_library_errors
    raise ConnectionError(str(exc)) from exc
kombu.exceptions.OperationalError: Error 111 connecting to localhost:6379. Connection refused.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
sqlite3.OperationalError: database table is locked: chatbot_receiptprocessing

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 196, in process_receipt
    receipt_record = await sync_to_async(ReceiptProcessing.objects.get)(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        id=receipt_processing_id
        ^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 439, in __call__
    ret = await asyncio.shield(exec_coro)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 491, in thread_handler
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 629, in get
    num = len(clone)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 366, in __len__
    self._fetch_all()
    ~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1949, in _fetch_all
    self._result_cache = list(self._iterable_class(self))
                         ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 91, in __iter__
    results = compiler.execute_sql(
        chunked_fetch=self.chunked_fetch, chunk_size=self.chunk_size
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        sql, params, many=False, executor=self._execute
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
django.db.utils.OperationalError: database table is locked: chatbot_receiptprocessing
[2025-08-16 20:52:39] INFO in chatbot.services.receipt_service: ‚úÖ Completed synchronous processing for receipt 1
[2025-08-16 20:52:39] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 1
[2025-08-16 20:54:45] INFO in chatbot.services.receipt_service: Created receipt processing record: 19
[2025-08-16 20:54:45] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 19
[2025-08-16 20:54:45] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 19 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-16 20:54:45] INFO in chatbot.services.receipt_service: Marking receipt 19 as processing...
[2025-08-16 20:54:45] DEBUG in chatbot.services.receipt_service: Receipt 19 status updated to: ocr_in_progress
[2025-08-16 20:54:45] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 19
[2025-08-16 20:54:49] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-16 20:55:08] WARNING in chatbot.services.receipt_service: ‚ö†Ô∏è Celery task failed for receipt 19: Error 111 connecting to localhost:6379. Connection refused.
[2025-08-16 20:55:08] INFO in chatbot.services.receipt_service: Falling back to synchronous processing for receipt 19
[2025-08-16 20:55:08] DEBUG in chatbot.services.receipt_service: Receipt processor imported successfully
[2025-08-16 20:55:08] INFO in chatbot.services.receipt_service: Starting synchronous OCR processing for receipt 19
[2025-08-16 20:55:08] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 19
[2025-08-16 20:55:08] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-16 20:55:08] INFO in chatbot.receipt_processor: ‚úÖ Found receipt record: 19, current status: ocr_in_progress
[2025-08-16 20:55:08] INFO in chatbot.receipt_processor: Updating receipt 19 status to 'ocr_in_progress'
[2025-08-16 20:55:08] DEBUG in chatbot.receipt_processor: Receipt 19 status updated successfully
[2025-08-16 20:55:08] INFO in chatbot.receipt_processor: Processing file: /home/marcin/PycharmProjects/agenty/media/receipt_files/2508020118133218_FIS1XDh.pdf
[2025-08-16 20:55:08] INFO in chatbot.receipt_processor: File size: 655865 bytes
[2025-08-16 20:55:08] INFO in chatbot.receipt_processor: Detected file type: pdf
[2025-08-16 20:55:08] INFO in chatbot.receipt_processor: üîç Starting text extraction from pdf file...
[2025-08-16 20:55:08] INFO in chatbot.receipt_processor: PDF page 0 has no text, using OCR
[2025-08-16 20:55:08] INFO in chatbot.receipt_processor: üì∑ Starting OCR text extraction from image: /tmp/tmpgdlkttjn.png
[2025-08-16 20:55:08] DEBUG in chatbot.receipt_processor: Initializing EasyOCR reader for image processing...
[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: EasyOCR detected 102 text regions
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 1: 'Biedronka' (confidence: 0.99)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 2: 'Codziennie niskie ceny' (confidence: 0.95)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 3: 'Sklep 3218 TARGOWA' (confidence: 0.57)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 4: 'Jeronimo Martins Polska 5. A.' (confidence: 0.78)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 5: 'ul. ≈ªniwna 5, 62-025 Kostrzyn' (confidence: 0.79)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 6: 'NIP 779-10-11-327' (confidence: 0.68)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 7: '02.08.2025 18:18' (confidence: 0.71)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 8: 'NIEFISKALNY' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 9: 'Nazwa' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 10: 'PTU' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 11: 'Ilo≈õƒá' (confidence: 0.63)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 12: 'Cena' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 13: 'Warto≈õƒá' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 14: 'PiwoOkoRadLimMiƒô0 ,' (confidence: 0.53)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 15: '1.000' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 16: '3,69' (confidence: 0.65)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 17: '3,69' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 18: 'PiwoOkoRadLimMiƒôO, :' (confidence: 0.50)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 19: '1.000' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 20: '3,69' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 21: '3,69' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 22: 'GranolaOchVitane5oo' (confidence: 0.77)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 23: '1.000' (confidence: 0.68)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 24: '11,99' (confidence: 0.98)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 25: '11,99' (confidence: 0.73)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 26: '≈ªelOldSpic4oomIMix' (confidence: 0.55)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 27: '1.000 x' (confidence: 0.94)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 28: '19,99' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 29: '19,99' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 30: 'Rabat' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 31: '-6,00' (confidence: 0.50)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 32: '13,99' (confidence: 0.90)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 33: '≈ªelOldSpic4OOmIMix' (confidence: 0.58)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 34: '1.000 x' (confidence: 0.92)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 35: '19,99' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 36: '19,99' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 37: 'Rabat' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 38: '+6,00' (confidence: 0.55)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 39: '13,99' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 40: '≈öwPodudzieKurczkg' (confidence: 0.98)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 41: '0.450' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 42: '13,49' (confidence: 0.96)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 43: '6,07' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 44: 'Par zFil z kur250g' (confidence: 0.92)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 45: '1.000 x' (confidence: 0.93)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 46: '5,99' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 47: '5,99' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 48: 'Rabat' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 49: '-2,20' (confidence: 0.58)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 50: '3,79' (confidence: 0.84)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 51: 'Par zFil z kur250g' (confidence: 0.92)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 52: '1.000' (confidence: 0.98)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 53: '5,99' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 54: '5,99' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 55: 'Rabat' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 56: '-2,20' (confidence: 0.84)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 57: '3,79' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 58: 'Sur√≥wka z pora450g' (confidence: 0.92)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 59: '1.000 x' (confidence: 0.97)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 60: '4,59' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 61: '4,59' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 62: 'JogurtGreckiFru 400g' (confidence: 0.78)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 63: '1.000' (confidence: 0.99)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 64: '2,85' (confidence: 0.73)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 65: '2,85' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 66: 'Rabat' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 67: '-0,36' (confidence: 0.65)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 68: '2,49' (confidence: 0.69)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 69: 'JogurtGreckiFru 400g' (confidence: 0.78)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 70: '1.000 x' (confidence: 0.83)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 71: '2,85' (confidence: 0.87)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 72: '2,85' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 73: 'Rabat' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 74: '-0,36' (confidence: 0.79)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 75: '2,49' (confidence: 0.70)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 76: 'JogurtGreckiFru 400g' (confidence: 0.81)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 77: '1.000' (confidence: 0.98)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 78: '2,85' (confidence: 0.99)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 79: '2,85' (confidence: 0.98)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 80: 'Rabat' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 81: '-0,36' (confidence: 0.71)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 82: '2,49' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 83: 'Win' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 84: 'op 500g' (confidence: 0.91)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 85: '1.000' (confidence: 0.87)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 86: '9,99' (confidence: 0.99)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 87: '9,99' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 88: 'Rabat' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 89: '-5,00' (confidence: 0.77)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 90: '4,99' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 91: 'Pizza z kurcz' (confidence: 0.92)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 92: '1.000' (confidence: 0.60)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 93: '12,79' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 94: '12,79' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 95: 'GulaszNS4OOg' (confidence: 0.90)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 96: '1.000' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 97: '11,99' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 98: '11,99' (confidence: 0.80)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 99: '3218/13/118/02.08.2025' (confidence: 0.68)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 100: 'Strona 1 z 2' (confidence: 0.98)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 101: 'bezp' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 102: '400g' (confidence: 0.63)
[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: ‚úÖ OCR extraction completed. Total text length: 908 characters
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: OCR extracted text: Biedronka Codziennie niskie ceny Sklep 3218 TARGOWA Jeronimo Martins Polska 5. A. ul. ≈ªniwna 5, 62-025 Kostrzyn NIP 779-10-11-327 02.08.2025 18:18 NIEFISKALNY Nazwa PTU Ilo≈õƒá Cena Warto≈õƒá PiwoOkoRadLimMiƒô0 , 1.000 3,69 3,69 PiwoOkoRadLimMiƒôO, : 1.000 3,69 3,69 GranolaOchVitane5oo 1.000 11,99 11,99 ≈ªelOldSpic4oomIMix 1.000 x 19,99 19,99 Rabat -6,00 13,99 ≈ªelOldSpic4OOmIMix 1.000 x 19,99 19,99 Rabat +6,00 13,99 ≈öwPodudzieKurczkg 0.450 13,49 6,07 Par zFil z kur250g 1.000 x 5,99 5,99 Rabat -2,20 3,79 Par zFil z kur250g 1.000 5,99 5,99 Rabat -2,20 3,79 Sur√≥wka z pora450g 1.000 x 4,59 4,59 JogurtGreckiFru 400g 1.000 2,85 2,85 Rabat -0,36 2,49 JogurtGreckiFru 400g 1.000 x 2,85 2,85 Rabat -0,36 2,49 JogurtGreckiFru 400g 1.000 2,85 2,85 Rabat -0,36 2,49 Win op 500g 1.000 9,99 9,99 Rabat -5,00 4,99 Pizza z kurcz 1.000 12,79 12,79 GulaszNS4OOg 1.000 11,99 11,99 3218/13/118/02.08.2025 Strona 1 z 2 bezp 400g
[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: PDF page 1 has no text, using OCR
[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: üì∑ Starting OCR text extraction from image: /tmp/tmpvbmsx6sa.png
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Initializing EasyOCR reader for image processing...
[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: EasyOCR detected 20 text regions
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 1: 'Sprzeda≈º opodatkowana C' (confidence: 0.64)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 2: '74,85' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 3: 'PTU C 5%' (confidence: 0.84)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 4: '3,56' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 5: 'Sprzeda≈º opodatkowana' (confidence: 0.68)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 6: '27,98' (confidence: 0.99)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 7: 'PTU A 23%' (confidence: 0.79)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 8: '5,23' (confidence: 0.82)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 9: 'Suma PTU' (confidence: 0.92)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 10: '8,79' (confidence: 0.99)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 11: 'Suma PLN' (confidence: 0.87)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 12: '102,83' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 13: 'Kasa 13 Kasjer' (confidence: 0.97)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 14: '1000032180118204013106' (confidence: 0.94)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 15: 'Inna BLIK' (confidence: 0.98)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 16: '102,83' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 17: 'Numer transakcji' (confidence: 0.90)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 18: '118' (confidence: 1.00)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 19: '3218/13/118/02.08.2025' (confidence: 0.68)
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Region 20: 'Strona 2 z 2' (confidence: 0.99)
[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: ‚úÖ OCR extraction completed. Total text length: 228 characters
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: OCR extracted text: Sprzeda≈º opodatkowana C 74,85 PTU C 5% 3,56 Sprzeda≈º opodatkowana 27,98 PTU A 23% 5,23 Suma PTU 8,79 Suma PLN 102,83 Kasa 13 Kasjer 1000032180118204013106 Inna BLIK 102,83 Numer transakcji 118 3218/13/118/02.08.2025 Strona 2 z 2
[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: PDF text extracted: Biedronka Codziennie niskie ceny Sklep 3218 TARGOWA Jeronimo Martins Polska 5. A. ul. ≈ªniwna 5, 62-025 Kostrzyn NIP 779-10-11-327 02.08.2025 18:18 NIEFISKALNY Nazwa PTU Ilo≈õƒá Cena Warto≈õƒá PiwoOkoRadLimMiƒô0 , 1.000 3,69 3,69 PiwoOkoRadLimMiƒôO, : 1.000 3,69 3,69 GranolaOchVitane5oo 1.000 11,99 11,99 ≈ªelOldSpic4oomIMix 1.000 x 19,99 19,99 Rabat -6,00 13,99 ≈ªelOldSpic4OOmIMix 1.000 x 19,99 19,99 Rabat +6,00 13,99 ≈öwPodudzieKurczkg 0.450 13,49 6,07 Par zFil z kur250g 1.000 x 5,99 5,99 Rabat -2,20 3,79 Par zFil z kur250g 1.000 5,99 5,99 Rabat -2,20 3,79 Sur√≥wka z pora450g 1.000 x 4,59 4,59 JogurtGreckiFru 400g 1.000 2,85 2,85 Rabat -0,36 2,49 JogurtGreckiFru 400g 1.000 x 2,85 2,85 Rabat -0,36 2,49 JogurtGreckiFru 400g 1.000 2,85 2,85 Rabat -0,36 2,49 Win op 500g 1.000 9,99 9,99 Rabat -5,00 4,99 Pizza z kurcz 1.000 12,79 12,79 GulaszNS4OOg 1.000 11,99 11,99 3218/13/118/02.08.2025 Strona 1 z 2 bezp 400g
Sprzeda≈º opodatkowana C 74,85 PTU C 5% 3,56 Sprzeda≈º opodatkowana 27,98 PTU A 23% 5,23 Suma PTU 8,79 Suma PLN 102,83 Kasa 13 Kasjer 1000032180118204013106 Inna BLIK 102,83 Numer transakcji 118 3218/13/118/02.08.2025 Strona 2 z 2

[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: ‚úÖ OCR text extraction completed. Extracted 1137 characters
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Extracted text preview: Biedronka Codziennie niskie ceny Sklep 3218 TARGOWA Jeronimo Martins Polska 5. A. ul. ≈ªniwna 5, 62-025 Kostrzyn NIP 779-10-11-327 02.08.2025 18:18 NIEFISKALNY Nazwa PTU Ilo≈õƒá Cena Warto≈õƒá PiwoOkoRadLi...
[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: Receipt 19 status updated to 'ocr_done'
[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction for receipt 19
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Receipt 19 status updated to 'llm_in_progress'
[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction...
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Input text length: 1137 characters
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Input text preview: Biedronka Codziennie niskie ceny Sklep 3218 TARGOWA Jeronimo Martins Polska 5. A. ul. ≈ªniwna 5, 62-025 Kostrzyn NIP 779-10-11-327 02.08.2025 18:18 NIEFISKALNY Nazwa PTU Ilo≈õƒá Cena Warto≈õƒá PiwoOkoRadLimMiƒô0 , 1.000 3,69 3,69 PiwoOkoRadLimMiƒôO, : 1.000 3,69 3,69 GranolaOchVitane5oo 1.000 11,99 11,99 ≈ª...
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Prepared LLM prompt (length: 1998 chars)
[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: Sending request to LLM model...
[2025-08-16 20:55:09] DEBUG in chatbot.receipt_processor: Initializing OllamaAgent for product extraction...
[2025-08-16 20:55:09] INFO in chatbot.receipt_processor: Calling LLM to process receipt text...
[2025-08-16 20:56:09] INFO in chatbot.receipt_processor: ‚úÖ LLM response received (length: 120 chars)
[2025-08-16 20:56:09] DEBUG in chatbot.receipt_processor: LLM raw response: Przepraszam, g≈Ç√≥wny system AI jest obecnie niedostƒôpny. Spr√≥buj ponownie za chwilƒô lub skontaktuj siƒô z administratorem.
[2025-08-16 20:56:09] INFO in chatbot.receipt_processor: Parsing JSON from LLM response...
[2025-08-16 20:56:09] WARNING in chatbot.receipt_processor: ‚ùå LLM response did not contain valid JSON array
[2025-08-16 20:56:09] DEBUG in chatbot.receipt_processor: Problematic response: Przepraszam, g≈Ç√≥wny system AI jest obecnie niedostƒôpny. Spr√≥buj ponownie za chwilƒô lub skontaktuj siƒô z administratorem.
[2025-08-16 20:56:09] INFO in chatbot.receipt_processor: LLM processing completed. Found 0 products
[2025-08-16 20:56:09] ERROR in chatbot.receipt_processor: ‚ùå Nie uda≈Ço siƒô wyodrƒôbniƒá produkt√≥w przez LLM.
[2025-08-16 20:56:09] INFO in chatbot.services.receipt_service: ‚úÖ Completed synchronous processing for receipt 19
[2025-08-16 20:56:09] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 19
[2025-08-16 21:05:33] INFO in chatbot.services.receipt_service: Created receipt processing record: 20
[2025-08-16 21:05:33] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 20
[2025-08-16 21:05:33] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 20 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-16 21:05:33] INFO in chatbot.services.receipt_service: Marking receipt 20 as processing...
[2025-08-16 21:05:33] DEBUG in chatbot.services.receipt_service: Receipt 20 status updated to: ocr_in_progress
[2025-08-16 21:05:33] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 20
[2025-08-16 21:05:33] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-16 21:05:52] WARNING in chatbot.services.receipt_service: ‚ö†Ô∏è Celery task failed for receipt 20: Error 111 connecting to localhost:6379. Connection refused.
[2025-08-16 21:05:52] INFO in chatbot.services.receipt_service: Falling back to synchronous processing for receipt 20
[2025-08-16 21:05:52] DEBUG in chatbot.services.receipt_service: Receipt processor imported successfully
[2025-08-16 21:05:52] INFO in chatbot.services.receipt_service: Starting synchronous OCR processing for receipt 20
[2025-08-16 21:05:52] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 20
[2025-08-16 21:05:52] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-16 21:05:52] INFO in chatbot.receipt_processor: ‚úÖ Found receipt record: 20, current status: ocr_in_progress
[2025-08-16 21:05:52] INFO in chatbot.receipt_processor: Updating receipt 20 status to 'ocr_in_progress'
[2025-08-16 21:05:52] DEBUG in chatbot.receipt_processor: Receipt 20 status updated successfully
[2025-08-16 21:05:52] INFO in chatbot.receipt_processor: Processing file: /home/marcin/PycharmProjects/agenty/media/receipt_files/receipt.pdf
[2025-08-16 21:05:52] INFO in chatbot.receipt_processor: File size: 471980 bytes
[2025-08-16 21:05:52] INFO in chatbot.receipt_processor: Detected file type: pdf
[2025-08-16 21:05:52] INFO in chatbot.receipt_processor: üîç Starting text extraction from pdf file...
[2025-08-16 21:05:52] INFO in chatbot.receipt_processor: PDF page 0 has no text, using OCR
[2025-08-16 21:05:52] INFO in chatbot.receipt_processor: üì∑ Starting OCR text extraction from image: /tmp/tmpnlgl4z9b.png
[2025-08-16 21:05:52] DEBUG in chatbot.receipt_processor: Initializing EasyOCR reader for image processing...
[2025-08-16 21:05:53] INFO in chatbot.receipt_processor: EasyOCR detected 86 text regions
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 1: 'Biedronka' (confidence: 0.99)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 2: 'Codziennie niskie ceny' (confidence: 0.95)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 3: 'Sklep 3218 TARGOWA' (confidence: 0.57)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 4: 'Jeronimo Martins Polska 5. A.' (confidence: 0.78)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 5: 'ul. ≈ªniwna 5, 62-025 Kostrzyn' (confidence: 0.79)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 6: 'NIP 779-10-11-327' (confidence: 0.68)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 7: '13.01.2025 13.57' (confidence: 0.80)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 8: 'NIEFISKALNY' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 9: 'Nazwa' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 10: 'PTU' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 11: 'Ilo≈õƒá' (confidence: 0.63)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 12: 'Cena' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 13: 'Warto≈õƒá' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 14: 'Mleko UHT 1,5' (confidence: 0.72)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 15: '1/' (confidence: 0.45)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 16: '1.000' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 17: '3,29' (confidence: 0.89)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 18: '3,29' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 19: 'PomKroNaszSpi≈º240g' (confidence: 0.68)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 20: '1.000 x' (confidence: 0.96)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 21: '2,99' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 22: '2,99' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 23: 'PomKroNaszSpi≈º240g' (confidence: 0.98)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 24: '1.000' (confidence: 0.98)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 25: '2,99' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 26: '2,99' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 27: 'Jogurt Nat 190 200g' (confidence: 0.52)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 28: '1.000' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 29: '1,05' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 30: '1,05' (confidence: 0.99)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 31: 'Jogurt Nat 190 200g' (confidence: 0.60)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 32: '1.000' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 33: '1,05' (confidence: 0.92)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 34: '1,05' (confidence: 0.99)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 35: 'PaprykaOstraKamisl6' (confidence: 0.94)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 36: '1.000' (confidence: 0.97)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 37: '1,99' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 38: '1,99' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 39: 'SoczewicaPloNa5OOg' (confidence: 0.69)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 40: '1.000 x' (confidence: 0.92)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 41: '5,86' (confidence: 0.99)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 42: '5,86' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 43: 'WafelEstellaDes5Og' (confidence: 0.52)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 44: '1.000' (confidence: 0.81)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 45: '1,19' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 46: '1,19' (confidence: 0.56)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 47: 'SerTwarP√≥≈Çt≈Çu25Og' (confidence: 0.91)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 48: '1.000 x' (confidence: 0.80)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 49: '3,95' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 50: '3,95' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 51: 'MarchewLuz' (confidence: 0.88)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 52: '0.365' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 53: '3,69' (confidence: 0.97)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 54: '1,35' (confidence: 0.95)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 55: 'Rabat' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 56: '~0,62' (confidence: 0.52)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 57: '0,73' (confidence: 0.59)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 58: 'Papryka Stoaka' (confidence: 0.78)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 59: '0.220 x' (confidence: 0.97)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 60: '13,99' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 61: '3,08' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 62: '(zerw' (confidence: 0.89)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 63: 'Cebula ≈ª√≥≈Çta Luz' (confidence: 0.94)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 64: '0.455' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 65: '3,49' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 66: '1,59' (confidence: 0.64)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 67: 'Sprzeda≈º opodatkowana ‚Ç¨' (confidence: 0.74)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 68: '27,77' (confidence: 0.76)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 69: 'PTU C 5%' (confidence: 0.62)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 70: '1,32' (confidence: 0.94)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 71: 'Sprzeda≈º opodatkowana' (confidence: 0.99)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 72: '1,99' (confidence: 0.97)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 73: 'PTU B 8%' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 74: '0,15' (confidence: 0.66)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 75: 'Suma PTU' (confidence: 0.87)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 76: '1,47' (confidence: 0.99)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 77: 'Suma PLN' (confidence: 0.92)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 78: '29,76' (confidence: 0.77)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 79: 'Kasa 13 Kasjer' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 80: '1000032188196183913639' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 81: 'Card p≈Çatnicza' (confidence: 0.92)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 82: '29,76' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 83: 'Numer transakcji' (confidence: 0.91)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 84: '8196' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 85: '3218/13/8196/13.01.2025' (confidence: 1.00)
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Region 86: 'Strona 1 z 1' (confidence: 0.95)
[2025-08-16 21:05:53] INFO in chatbot.receipt_processor: ‚úÖ OCR extraction completed. Total text length: 857 characters
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: OCR extracted text: Biedronka Codziennie niskie ceny Sklep 3218 TARGOWA Jeronimo Martins Polska 5. A. ul. ≈ªniwna 5, 62-025 Kostrzyn NIP 779-10-11-327 13.01.2025 13.57 NIEFISKALNY Nazwa PTU Ilo≈õƒá Cena Warto≈õƒá Mleko UHT 1,5 1/ 1.000 3,29 3,29 PomKroNaszSpi≈º240g 1.000 x 2,99 2,99 PomKroNaszSpi≈º240g 1.000 2,99 2,99 Jogurt Nat 190 200g 1.000 1,05 1,05 Jogurt Nat 190 200g 1.000 1,05 1,05 PaprykaOstraKamisl6 1.000 1,99 1,99 SoczewicaPloNa5OOg 1.000 x 5,86 5,86 WafelEstellaDes5Og 1.000 1,19 1,19 SerTwarP√≥≈Çt≈Çu25Og 1.000 x 3,95 3,95 MarchewLuz 0.365 3,69 1,35 Rabat ~0,62 0,73 Papryka Stoaka 0.220 x 13,99 3,08 (zerw Cebula ≈ª√≥≈Çta Luz 0.455 3,49 1,59 Sprzeda≈º opodatkowana ‚Ç¨ 27,77 PTU C 5% 1,32 Sprzeda≈º opodatkowana 1,99 PTU B 8% 0,15 Suma PTU 1,47 Suma PLN 29,76 Kasa 13 Kasjer 1000032188196183913639 Card p≈Çatnicza 29,76 Numer transakcji 8196 3218/13/8196/13.01.2025 Strona 1 z 1
[2025-08-16 21:05:53] INFO in chatbot.receipt_processor: PDF text extracted: Biedronka Codziennie niskie ceny Sklep 3218 TARGOWA Jeronimo Martins Polska 5. A. ul. ≈ªniwna 5, 62-025 Kostrzyn NIP 779-10-11-327 13.01.2025 13.57 NIEFISKALNY Nazwa PTU Ilo≈õƒá Cena Warto≈õƒá Mleko UHT 1,5 1/ 1.000 3,29 3,29 PomKroNaszSpi≈º240g 1.000 x 2,99 2,99 PomKroNaszSpi≈º240g 1.000 2,99 2,99 Jogurt Nat 190 200g 1.000 1,05 1,05 Jogurt Nat 190 200g 1.000 1,05 1,05 PaprykaOstraKamisl6 1.000 1,99 1,99 SoczewicaPloNa5OOg 1.000 x 5,86 5,86 WafelEstellaDes5Og 1.000 1,19 1,19 SerTwarP√≥≈Çt≈Çu25Og 1.000 x 3,95 3,95 MarchewLuz 0.365 3,69 1,35 Rabat ~0,62 0,73 Papryka Stoaka 0.220 x 13,99 3,08 (zerw Cebula ≈ª√≥≈Çta Luz 0.455 3,49 1,59 Sprzeda≈º opodatkowana ‚Ç¨ 27,77 PTU C 5% 1,32 Sprzeda≈º opodatkowana 1,99 PTU B 8% 0,15 Suma PTU 1,47 Suma PLN 29,76 Kasa 13 Kasjer 1000032188196183913639 Card p≈Çatnicza 29,76 Numer transakcji 8196 3218/13/8196/13.01.2025 Strona 1 z 1

[2025-08-16 21:05:53] INFO in chatbot.receipt_processor: ‚úÖ OCR text extraction completed. Extracted 857 characters
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Extracted text preview: Biedronka Codziennie niskie ceny Sklep 3218 TARGOWA Jeronimo Martins Polska 5. A. ul. ≈ªniwna 5, 62-025 Kostrzyn NIP 779-10-11-327 13.01.2025 13.57 NIEFISKALNY Nazwa PTU Ilo≈õƒá Cena Warto≈õƒá Mleko UHT 1,...
[2025-08-16 21:05:53] INFO in chatbot.receipt_processor: Receipt 20 status updated to 'ocr_done'
[2025-08-16 21:05:53] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction for receipt 20
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Receipt 20 status updated to 'llm_in_progress'
[2025-08-16 21:05:53] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction...
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Input text length: 857 characters
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Input text preview: Biedronka Codziennie niskie ceny Sklep 3218 TARGOWA Jeronimo Martins Polska 5. A. ul. ≈ªniwna 5, 62-025 Kostrzyn NIP 779-10-11-327 13.01.2025 13.57 NIEFISKALNY Nazwa PTU Ilo≈õƒá Cena Warto≈õƒá Mleko UHT 1,5 1/ 1.000 3,29 3,29 PomKroNaszSpi≈º240g 1.000 x 2,99 2,99 PomKroNaszSpi≈º240g 1.000 2,99 2,99 Jogurt ...
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Prepared LLM prompt (length: 1718 chars)
[2025-08-16 21:05:53] INFO in chatbot.receipt_processor: Sending request to LLM model...
[2025-08-16 21:05:53] DEBUG in chatbot.receipt_processor: Initializing OllamaAgent for product extraction...
[2025-08-16 21:05:53] INFO in chatbot.receipt_processor: Calling LLM to process receipt text...
[2025-08-16 21:08:53] ERROR in chatbot.receipt_processor: ‚ùå Unexpected error during LLM product extraction: 
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/connection_pool.py", line 236, in handle_async_request
    response = await connection.handle_async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool_request.request
        ^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/connection.py", line 103, in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/http11.py", line 136, in handle_async_request
    raise exc
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/http11.py", line 106, in handle_async_request
    ) = await self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/http11.py", line 177, in _receive_response_headers
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/http11.py", line 217, in _receive_event
    data = await self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.READ_NUM_BYTES, timeout=timeout
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_backends/anyio.py", line 32, in read
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ReadTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 152, in _extract_products_with_llm
    response = await ollama_agent.process_with_ollama({"message": prompt, "history": []})
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/chatbot/services/agents.py", line 144, in process_with_ollama
    response = await client.post(full_url, json=payload, headers=headers)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ReadTimeout
[2025-08-16 21:08:53] INFO in chatbot.receipt_processor: LLM processing completed. Found 0 products
[2025-08-16 21:08:53] ERROR in chatbot.receipt_processor: ‚ùå Nie uda≈Ço siƒô wyodrƒôbniƒá produkt√≥w przez LLM.
[2025-08-16 21:08:53] INFO in chatbot.services.receipt_service: ‚úÖ Completed synchronous processing for receipt 20
[2025-08-16 21:08:53] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 20
[2025-08-17 05:00:44] INFO in chatbot.services.receipt_service: Created receipt processing record: 21
[2025-08-17 05:00:44] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 21
[2025-08-17 05:00:44] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 21 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-17 05:00:44] INFO in chatbot.services.receipt_service: Marking receipt 21 as processing...
[2025-08-17 05:00:44] DEBUG in chatbot.services.receipt_service: Receipt 21 status updated to: ocr_in_progress
[2025-08-17 05:00:44] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 21
[2025-08-17 05:00:47] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-17 05:01:07] WARNING in chatbot.services.receipt_service: ‚ö†Ô∏è Celery task failed for receipt 21: Error 111 connecting to localhost:6379. Connection refused.
[2025-08-17 05:01:07] INFO in chatbot.services.receipt_service: Falling back to synchronous processing for receipt 21
[2025-08-17 05:01:07] DEBUG in chatbot.services.receipt_service: Receipt processor imported successfully
[2025-08-17 05:01:07] INFO in chatbot.services.receipt_service: Starting synchronous OCR processing for receipt 21
[2025-08-17 05:01:07] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 21
[2025-08-17 05:01:07] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-17 05:01:07] INFO in chatbot.receipt_processor: ‚úÖ Found receipt record: 21, current status: ocr_in_progress
[2025-08-17 05:01:07] INFO in chatbot.receipt_processor: Updating receipt 21 status to 'ocr_in_progress'
[2025-08-17 05:01:07] DEBUG in chatbot.receipt_processor: Receipt 21 status updated successfully
[2025-08-17 05:01:07] INFO in chatbot.receipt_processor: Processing file: /home/marcin/PycharmProjects/agenty/media/receipt_files/45124711000057030425.pdf
[2025-08-17 05:01:07] INFO in chatbot.receipt_processor: File size: 366917 bytes
[2025-08-17 05:01:07] INFO in chatbot.receipt_processor: Detected file type: pdf
[2025-08-17 05:01:07] INFO in chatbot.receipt_processor: üîç Starting text extraction from pdf file...
[2025-08-17 05:01:07] INFO in chatbot.receipt_processor: PDF page 0 has no text, using OCR
[2025-08-17 05:01:07] INFO in chatbot.receipt_processor: üì∑ Starting OCR text extraction from image: /tmp/tmpy0mr2m68.png
[2025-08-17 05:01:07] DEBUG in chatbot.receipt_processor: Initializing EasyOCR reader for image processing...
[2025-08-17 05:01:08] INFO in chatbot.receipt_processor: EasyOCR detected 158 text regions
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 1: 'Xuchan' (confidence: 0.40)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 2: 'HIPERMARKET' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 3: 'AUCHAN' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 4: '05-270' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 5: 'WARSZAWA' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 6: 'MARKI' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 7: 'AL' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 8: 'J .PI≈ÅSUDSKIEGO' (confidence: 0.83)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 9: 'TEL _' (confidence: 0.74)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 10: '(0-22)' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 11: '444' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 12: '02' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 13: '22' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 14: 'AUCHAN' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 15: 'POLSKA' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 16: 'SP' (confidence: 0.99)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 17: 'Z' (confidence: 0.17)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 18: '0 .0 _' (confidence: 0.52)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 19: 'UL' (confidence: 0.93)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 20: 'PU≈ÅAWSKA' (confidence: 0.61)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 21: '46 ,' (confidence: 0.99)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 22: '05-500' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 23: 'PIASECZNO' (confidence: 0.97)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 24: 'WWW' (confidence: 0.96)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 25: 'auchan.pl' (confidence: 0.95)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 26: 'BDO' (confidence: 0.99)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 27: '000013917' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 28: 'NIP:' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 29: '526-03-09-174' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 30: 'NIEFISKALNY' (confidence: 0.95)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 31: '2025-03-04' (confidence: 0.86)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 32: 'ReWtymOplRec551061' (confidence: 0.96)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 33: 'x3 , 25' (confidence: 0.70)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 34: '3 , 25A' (confidence: 0.69)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 35: 'NAPOJ' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 36: 'GAZ' (confidence: 0.99)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 37: '86851A' (confidence: 0.46)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 38: 'x4 , 48' (confidence: 0.84)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 39: '4 , 48A' (confidence: 0.76)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 40: 'PAROWKI' (confidence: 0.99)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 41: 'JAL' (confidence: 0.99)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 42: '32107c' (confidence: 0.87)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 43: 'x6 , 28' (confidence: 0.81)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 44: '6 , 28c' (confidence: 0.41)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 45: 'PAPIER' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 46: 'TOAL' (confidence: 0.84)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 47: '34663A' (confidence: 0.64)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 48: 'xl9 , 98' (confidence: 0.54)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 49: '19 , 98A' (confidence: 0.76)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 50: 'MIELONE' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 51: '571950c' (confidence: 0.54)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 52: 'xl0 , 98' (confidence: 0.57)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 53: '10 , 98c' (confidence: 0.26)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 54: 'SANDWICH' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 55: '958560c' (confidence: 0.82)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 56: 'x5 , 39' (confidence: 0.94)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 57: '5 , 39C' (confidence: 0.50)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 58: 'ORZES ZKI' (confidence: 0.59)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 59: '492359C' (confidence: 0.67)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 60: 'x3 , 99' (confidence: 0.97)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 61: '3 , 99C' (confidence: 0.56)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 62: 'CIASTO' (confidence: 0.97)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 63: 'FRA' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 64: '998924C' (confidence: 0.78)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 65: 'x5 , 99' (confidence: 0.79)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 66: '5 , 99c' (confidence: 0.63)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 67: 'PASTA' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 68: 'MAX' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 69: 'E' (confidence: 0.36)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 70: '52829A' (confidence: 0.99)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 71: '1' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 72: 'x5 , 61' (confidence: 0.92)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 73: '5 , 61A' (confidence: 0.98)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 74: 'SER' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 75: 'MOZZAR' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 76: '751976c' (confidence: 0.67)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 77: '0 , 304' (confidence: 0.79)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 78: 'x33 , 89' (confidence: 0.63)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 79: '10 , 30c' (confidence: 0.52)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 80: 'AWOKADO' (confidence: 0.99)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 81: '34067C' (confidence: 0.42)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 82: 'x2 , 95' (confidence: 0.97)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 83: '2 , 95c' (confidence: 0.65)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 84: 'CHIPSY' (confidence: 0.87)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 85: 'KET' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 86: '521902c' (confidence: 0.83)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 87: 'x4 , 99' (confidence: 0.62)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 88: '4 , 99C' (confidence: 0.69)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 89: 'KRAJALNI' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 90: '691060A' (confidence: 0.65)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 91: 'x8 , 99' (confidence: 0.77)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 92: '8 , 99A' (confidence: 0.97)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 93: 'ZIEMNIAK' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 94: '581227c' (confidence: 0.79)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 95: 'x8 , 98' (confidence: 0.92)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 96: '8 , 98C' (confidence: 0.49)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 97: 'SZAMPON' (confidence: 0.96)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 98: 'WL' (confidence: 0.39)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 99: '450850' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 100: 'xl6 , 99' (confidence: 0.53)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 101: '16 , 99A' (confidence: 0.59)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 102: 'KAPUSTA' (confidence: 0.99)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 103: 'BIA' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 104: '2 7891c' (confidence: 0.83)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 105: '1 , 538' (confidence: 0.50)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 106: 'x4 , 49' (confidence: 0.89)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 107: '6 , 91c' (confidence: 0.58)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 108: 'JAJA' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 109: 'WOLNY' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 110: '103729c' (confidence: 0.53)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 111: 'x7 , 69' (confidence: 0.85)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 112: '7 , 69C' (confidence: 0.51)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 113: 'BATON' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 114: 'PAWE' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 115: '502905A' (confidence: 0.95)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 116: 'x2 , 48' (confidence: 0.76)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 117: '2 , 48A' (confidence: 0.79)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 118: 'Rabat' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 119: 'ORZESZKI' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 120: 'W' (confidence: 0.95)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 121: '492359c' (confidence: 0.62)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 122: '-0 , 80c' (confidence: 0.70)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 123: 'SPRZEDA≈ª' (confidence: 0.98)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 124: 'OPODATK' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 125: '61, 78' (confidence: 0.95)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 126: 'PTU' (confidence: 0.99)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 127: '23 , 00' (confidence: 0.90)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 128: '11,55' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 129: 'SPRZEDAZ' (confidence: 0.75)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 130: 'OPODATK' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 131: '73 , 65' (confidence: 0.79)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 132: 'PTU' (confidence: 0.85)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 133: 'C' (confidence: 0.78)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 134: '05 , 00' (confidence: 0.63)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 135: '3 , 51' (confidence: 0.84)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 136: 'SUMA' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 137: 'PTU' (confidence: 0.99)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 138: '15, 0 6' (confidence: 0.51)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 139: 'SUMA' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 140: 'PLN' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 141: '135,43' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 142: '#711' (confidence: 0.92)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 143: '00000711' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 144: '11:56' (confidence: 0.89)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 145: 'Karty plat' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 146: '135 , 43' (confidence: 0.64)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 147: 'PLN' (confidence: 0.97)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 148: 'Udzielono' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 149: '≈ÇƒÖcznie' (confidence: 0.98)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 150: 'rabat√≥w' (confidence: 0.97)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 151: '0' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 152: '80' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 153: 'Nr' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 154: 'transakcji:' (confidence: 0.99)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 155: '0057' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 156: 'Kasa: 711' (confidence: 0.93)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 157: 'Kasjer:711' (confidence: 1.00)
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Region 158: '45124711000057030425' (confidence: 0.72)
[2025-08-17 05:01:08] INFO in chatbot.receipt_processor: ‚úÖ OCR extraction completed. Total text length: 1151 characters
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: OCR extracted text: Xuchan HIPERMARKET AUCHAN 05-270 WARSZAWA MARKI AL J .PI≈ÅSUDSKIEGO TEL _ (0-22) 444 02 22 AUCHAN POLSKA SP Z 0 .0 _ UL PU≈ÅAWSKA 46 , 05-500 PIASECZNO WWW auchan.pl BDO 000013917 NIP: 526-03-09-174 NIEFISKALNY 2025-03-04 ReWtymOplRec551061 x3 , 25 3 , 25A NAPOJ GAZ 86851A x4 , 48 4 , 48A PAROWKI JAL 32107c x6 , 28 6 , 28c PAPIER TOAL 34663A xl9 , 98 19 , 98A MIELONE 571950c xl0 , 98 10 , 98c SANDWICH 958560c x5 , 39 5 , 39C ORZES ZKI 492359C x3 , 99 3 , 99C CIASTO FRA 998924C x5 , 99 5 , 99c PASTA MAX E 52829A 1 x5 , 61 5 , 61A SER MOZZAR 751976c 0 , 304 x33 , 89 10 , 30c AWOKADO 34067C x2 , 95 2 , 95c CHIPSY KET 521902c x4 , 99 4 , 99C KRAJALNI 691060A x8 , 99 8 , 99A ZIEMNIAK 581227c x8 , 98 8 , 98C SZAMPON WL 450850 xl6 , 99 16 , 99A KAPUSTA BIA 2 7891c 1 , 538 x4 , 49 6 , 91c JAJA WOLNY 103729c x7 , 69 7 , 69C BATON PAWE 502905A x2 , 48 2 , 48A Rabat ORZESZKI W 492359c -0 , 80c SPRZEDA≈ª OPODATK 61, 78 PTU 23 , 00 11,55 SPRZEDAZ OPODATK 73 , 65 PTU C 05 , 00 3 , 51 SUMA PTU 15, 0 6 SUMA PLN 135,43 #711 00000711 11:56 Karty plat 135 , 43 PLN Udzielono ≈ÇƒÖcznie rabat√≥w 0 80 Nr transakcji: 0057 Kasa: 711 Kasjer:711 45124711000057030425
[2025-08-17 05:01:08] INFO in chatbot.receipt_processor: PDF text extracted: Xuchan HIPERMARKET AUCHAN 05-270 WARSZAWA MARKI AL J .PI≈ÅSUDSKIEGO TEL _ (0-22) 444 02 22 AUCHAN POLSKA SP Z 0 .0 _ UL PU≈ÅAWSKA 46 , 05-500 PIASECZNO WWW auchan.pl BDO 000013917 NIP: 526-03-09-174 NIEFISKALNY 2025-03-04 ReWtymOplRec551061 x3 , 25 3 , 25A NAPOJ GAZ 86851A x4 , 48 4 , 48A PAROWKI JAL 32107c x6 , 28 6 , 28c PAPIER TOAL 34663A xl9 , 98 19 , 98A MIELONE 571950c xl0 , 98 10 , 98c SANDWICH 958560c x5 , 39 5 , 39C ORZES ZKI 492359C x3 , 99 3 , 99C CIASTO FRA 998924C x5 , 99 5 , 99c PASTA MAX E 52829A 1 x5 , 61 5 , 61A SER MOZZAR 751976c 0 , 304 x33 , 89 10 , 30c AWOKADO 34067C x2 , 95 2 , 95c CHIPSY KET 521902c x4 , 99 4 , 99C KRAJALNI 691060A x8 , 99 8 , 99A ZIEMNIAK 581227c x8 , 98 8 , 98C SZAMPON WL 450850 xl6 , 99 16 , 99A KAPUSTA BIA 2 7891c 1 , 538 x4 , 49 6 , 91c JAJA WOLNY 103729c x7 , 69 7 , 69C BATON PAWE 502905A x2 , 48 2 , 48A Rabat ORZESZKI W 492359c -0 , 80c SPRZEDA≈ª OPODATK 61, 78 PTU 23 , 00 11,55 SPRZEDAZ OPODATK 73 , 65 PTU C 05 , 00 3 , 51 SUMA PTU 15, 0 6 SUMA PLN 135,43 #711 00000711 11:56 Karty plat 135 , 43 PLN Udzielono ≈ÇƒÖcznie rabat√≥w 0 80 Nr transakcji: 0057 Kasa: 711 Kasjer:711 45124711000057030425

[2025-08-17 05:01:08] INFO in chatbot.receipt_processor: ‚úÖ OCR text extraction completed. Extracted 1151 characters
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Extracted text preview: Xuchan HIPERMARKET AUCHAN 05-270 WARSZAWA MARKI AL J .PI≈ÅSUDSKIEGO TEL _ (0-22) 444 02 22 AUCHAN POLSKA SP Z 0 .0 _ UL PU≈ÅAWSKA 46 , 05-500 PIASECZNO WWW auchan.pl BDO 000013917 NIP: 526-03-09-174 NIE...
[2025-08-17 05:01:08] INFO in chatbot.receipt_processor: Receipt 21 status updated to 'ocr_done'
[2025-08-17 05:01:08] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction for receipt 21
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Receipt 21 status updated to 'llm_in_progress'
[2025-08-17 05:01:08] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction...
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Input text length: 1151 characters
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Input text preview: Xuchan HIPERMARKET AUCHAN 05-270 WARSZAWA MARKI AL J .PI≈ÅSUDSKIEGO TEL _ (0-22) 444 02 22 AUCHAN POLSKA SP Z 0 .0 _ UL PU≈ÅAWSKA 46 , 05-500 PIASECZNO WWW auchan.pl BDO 000013917 NIP: 526-03-09-174 NIEFISKALNY 2025-03-04 ReWtymOplRec551061 x3 , 25 3 , 25A NAPOJ GAZ 86851A x4 , 48 4 , 48A PAROWKI JAL ...
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Prepared LLM prompt (length: 2012 chars)
[2025-08-17 05:01:08] INFO in chatbot.receipt_processor: Sending request to LLM model...
[2025-08-17 05:01:08] DEBUG in chatbot.receipt_processor: Initializing OllamaAgent for product extraction...
[2025-08-17 05:01:08] INFO in chatbot.receipt_processor: Calling LLM to process receipt text...
[2025-08-17 05:04:08] ERROR in chatbot.receipt_processor: ‚ùå Unexpected error during LLM product extraction: 
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/connection_pool.py", line 236, in handle_async_request
    response = await connection.handle_async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool_request.request
        ^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/connection.py", line 103, in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/http11.py", line 136, in handle_async_request
    raise exc
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/http11.py", line 106, in handle_async_request
    ) = await self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/http11.py", line 177, in _receive_response_headers
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_async/http11.py", line 217, in _receive_event
    data = await self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.READ_NUM_BYTES, timeout=timeout
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_backends/anyio.py", line 32, in read
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ReadTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 152, in _extract_products_with_llm
    response = await ollama_agent.process_with_ollama({"message": prompt, "history": []})
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/chatbot/services/agents.py", line 153, in process_with_ollama
    response = await client.post(full_url, json=payload, headers=headers)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ReadTimeout
[2025-08-17 05:04:08] INFO in chatbot.receipt_processor: LLM processing completed. Found 0 products
[2025-08-17 05:04:08] ERROR in chatbot.receipt_processor: ‚ùå Nie uda≈Ço siƒô wyodrƒôbniƒá produkt√≥w przez LLM.
[2025-08-17 05:04:08] INFO in chatbot.services.receipt_service: ‚úÖ Completed synchronous processing for receipt 21
[2025-08-17 05:04:08] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 21
[2025-08-17 08:44:29] INFO in chatbot.services.receipt_service: Created receipt processing record: 22
[2025-08-17 08:44:29] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 22
[2025-08-17 08:44:29] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 22 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-17 08:44:29] INFO in chatbot.services.receipt_service: Marking receipt 22 as processing...
[2025-08-17 08:44:29] DEBUG in chatbot.services.receipt_service: Receipt 22 status updated to: ocr_in_progress
[2025-08-17 08:44:29] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 22
[2025-08-17 08:44:34] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-17 08:44:53] WARNING in chatbot.services.receipt_service: ‚ö†Ô∏è Celery task failed for receipt 22: Error 111 connecting to localhost:6379. Connection refused.
[2025-08-17 08:44:53] INFO in chatbot.services.receipt_service: Falling back to synchronous processing for receipt 22
[2025-08-17 08:44:53] DEBUG in chatbot.services.receipt_service: Receipt processor imported successfully
[2025-08-17 08:44:53] INFO in chatbot.services.receipt_service: Starting synchronous OCR processing for receipt 22
[2025-08-17 08:44:53] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 22
[2025-08-17 08:44:53] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-17 08:44:53] INFO in chatbot.receipt_processor: ‚úÖ Found receipt record: 22, current status: ocr_in_progress
[2025-08-17 08:44:53] INFO in chatbot.receipt_processor: Updating receipt 22 status to 'ocr_in_progress'
[2025-08-17 08:44:53] DEBUG in chatbot.receipt_processor: Receipt 22 status updated successfully
[2025-08-17 08:44:53] INFO in chatbot.receipt_processor: Processing file: /home/marcin/PycharmProjects/agenty/media/receipt_files/45124711000057030425_ktKX7BI.pdf
[2025-08-17 08:44:53] INFO in chatbot.receipt_processor: File size: 366917 bytes
[2025-08-17 08:44:53] INFO in chatbot.receipt_processor: Detected file type: pdf
[2025-08-17 08:44:53] INFO in chatbot.receipt_processor: üîç Starting text extraction from pdf file...
[2025-08-17 08:44:53] INFO in chatbot.receipt_processor: PDF page 0 has no text, using OCR
[2025-08-17 08:44:53] INFO in chatbot.receipt_processor: üì∑ Starting OCR text extraction from image: /tmp/tmp2khyf1p3.png
[2025-08-17 08:44:53] DEBUG in chatbot.receipt_processor: Initializing EasyOCR reader for image processing...
[2025-08-17 08:44:54] INFO in chatbot.receipt_processor: EasyOCR detected 158 text regions
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 1: 'Xuchan' (confidence: 0.40)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 2: 'HIPERMARKET' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 3: 'AUCHAN' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 4: '05-270' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 5: 'WARSZAWA' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 6: 'MARKI' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 7: 'AL' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 8: 'J .PI≈ÅSUDSKIEGO' (confidence: 0.83)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 9: 'TEL _' (confidence: 0.74)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 10: '(0-22)' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 11: '444' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 12: '02' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 13: '22' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 14: 'AUCHAN' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 15: 'POLSKA' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 16: 'SP' (confidence: 0.99)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 17: 'Z' (confidence: 0.17)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 18: '0 .0 _' (confidence: 0.52)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 19: 'UL' (confidence: 0.93)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 20: 'PU≈ÅAWSKA' (confidence: 0.61)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 21: '46 ,' (confidence: 0.99)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 22: '05-500' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 23: 'PIASECZNO' (confidence: 0.97)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 24: 'WWW' (confidence: 0.96)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 25: 'auchan.pl' (confidence: 0.95)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 26: 'BDO' (confidence: 0.99)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 27: '000013917' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 28: 'NIP:' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 29: '526-03-09-174' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 30: 'NIEFISKALNY' (confidence: 0.95)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 31: '2025-03-04' (confidence: 0.86)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 32: 'ReWtymOplRec551061' (confidence: 0.96)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 33: 'x3 , 25' (confidence: 0.70)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 34: '3 , 25A' (confidence: 0.69)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 35: 'NAPOJ' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 36: 'GAZ' (confidence: 0.99)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 37: '86851A' (confidence: 0.46)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 38: 'x4 , 48' (confidence: 0.84)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 39: '4 , 48A' (confidence: 0.76)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 40: 'PAROWKI' (confidence: 0.99)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 41: 'JAL' (confidence: 0.99)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 42: '32107c' (confidence: 0.87)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 43: 'x6 , 28' (confidence: 0.81)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 44: '6 , 28c' (confidence: 0.41)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 45: 'PAPIER' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 46: 'TOAL' (confidence: 0.84)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 47: '34663A' (confidence: 0.64)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 48: 'xl9 , 98' (confidence: 0.54)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 49: '19 , 98A' (confidence: 0.76)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 50: 'MIELONE' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 51: '571950c' (confidence: 0.54)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 52: 'xl0 , 98' (confidence: 0.57)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 53: '10 , 98c' (confidence: 0.26)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 54: 'SANDWICH' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 55: '958560c' (confidence: 0.82)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 56: 'x5 , 39' (confidence: 0.94)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 57: '5 , 39C' (confidence: 0.50)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 58: 'ORZES ZKI' (confidence: 0.59)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 59: '492359C' (confidence: 0.67)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 60: 'x3 , 99' (confidence: 0.97)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 61: '3 , 99C' (confidence: 0.56)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 62: 'CIASTO' (confidence: 0.97)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 63: 'FRA' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 64: '998924C' (confidence: 0.78)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 65: 'x5 , 99' (confidence: 0.79)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 66: '5 , 99c' (confidence: 0.63)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 67: 'PASTA' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 68: 'MAX' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 69: 'E' (confidence: 0.36)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 70: '52829A' (confidence: 0.99)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 71: '1' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 72: 'x5 , 61' (confidence: 0.92)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 73: '5 , 61A' (confidence: 0.98)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 74: 'SER' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 75: 'MOZZAR' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 76: '751976c' (confidence: 0.67)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 77: '0 , 304' (confidence: 0.79)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 78: 'x33 , 89' (confidence: 0.63)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 79: '10 , 30c' (confidence: 0.52)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 80: 'AWOKADO' (confidence: 0.99)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 81: '34067C' (confidence: 0.42)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 82: 'x2 , 95' (confidence: 0.97)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 83: '2 , 95c' (confidence: 0.65)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 84: 'CHIPSY' (confidence: 0.87)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 85: 'KET' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 86: '521902c' (confidence: 0.83)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 87: 'x4 , 99' (confidence: 0.62)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 88: '4 , 99C' (confidence: 0.69)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 89: 'KRAJALNI' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 90: '691060A' (confidence: 0.65)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 91: 'x8 , 99' (confidence: 0.77)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 92: '8 , 99A' (confidence: 0.97)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 93: 'ZIEMNIAK' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 94: '581227c' (confidence: 0.79)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 95: 'x8 , 98' (confidence: 0.92)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 96: '8 , 98C' (confidence: 0.49)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 97: 'SZAMPON' (confidence: 0.96)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 98: 'WL' (confidence: 0.39)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 99: '450850' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 100: 'xl6 , 99' (confidence: 0.53)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 101: '16 , 99A' (confidence: 0.59)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 102: 'KAPUSTA' (confidence: 0.99)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 103: 'BIA' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 104: '2 7891c' (confidence: 0.83)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 105: '1 , 538' (confidence: 0.50)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 106: 'x4 , 49' (confidence: 0.89)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 107: '6 , 91c' (confidence: 0.58)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 108: 'JAJA' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 109: 'WOLNY' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 110: '103729c' (confidence: 0.53)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 111: 'x7 , 69' (confidence: 0.85)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 112: '7 , 69C' (confidence: 0.51)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 113: 'BATON' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 114: 'PAWE' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 115: '502905A' (confidence: 0.95)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 116: 'x2 , 48' (confidence: 0.76)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 117: '2 , 48A' (confidence: 0.79)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 118: 'Rabat' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 119: 'ORZESZKI' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 120: 'W' (confidence: 0.95)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 121: '492359c' (confidence: 0.62)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 122: '-0 , 80c' (confidence: 0.70)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 123: 'SPRZEDA≈ª' (confidence: 0.98)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 124: 'OPODATK' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 125: '61, 78' (confidence: 0.95)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 126: 'PTU' (confidence: 0.99)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 127: '23 , 00' (confidence: 0.90)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 128: '11,55' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 129: 'SPRZEDAZ' (confidence: 0.75)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 130: 'OPODATK' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 131: '73 , 65' (confidence: 0.79)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 132: 'PTU' (confidence: 0.85)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 133: 'C' (confidence: 0.78)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 134: '05 , 00' (confidence: 0.63)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 135: '3 , 51' (confidence: 0.84)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 136: 'SUMA' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 137: 'PTU' (confidence: 0.99)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 138: '15, 0 6' (confidence: 0.51)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 139: 'SUMA' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 140: 'PLN' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 141: '135,43' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 142: '#711' (confidence: 0.92)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 143: '00000711' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 144: '11:56' (confidence: 0.89)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 145: 'Karty plat' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 146: '135 , 43' (confidence: 0.64)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 147: 'PLN' (confidence: 0.97)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 148: 'Udzielono' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 149: '≈ÇƒÖcznie' (confidence: 0.98)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 150: 'rabat√≥w' (confidence: 0.97)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 151: '0' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 152: '80' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 153: 'Nr' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 154: 'transakcji:' (confidence: 0.99)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 155: '0057' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 156: 'Kasa: 711' (confidence: 0.93)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 157: 'Kasjer:711' (confidence: 1.00)
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Region 158: '45124711000057030425' (confidence: 0.72)
[2025-08-17 08:44:54] INFO in chatbot.receipt_processor: ‚úÖ OCR extraction completed. Total text length: 1151 characters
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: OCR extracted text: Xuchan HIPERMARKET AUCHAN 05-270 WARSZAWA MARKI AL J .PI≈ÅSUDSKIEGO TEL _ (0-22) 444 02 22 AUCHAN POLSKA SP Z 0 .0 _ UL PU≈ÅAWSKA 46 , 05-500 PIASECZNO WWW auchan.pl BDO 000013917 NIP: 526-03-09-174 NIEFISKALNY 2025-03-04 ReWtymOplRec551061 x3 , 25 3 , 25A NAPOJ GAZ 86851A x4 , 48 4 , 48A PAROWKI JAL 32107c x6 , 28 6 , 28c PAPIER TOAL 34663A xl9 , 98 19 , 98A MIELONE 571950c xl0 , 98 10 , 98c SANDWICH 958560c x5 , 39 5 , 39C ORZES ZKI 492359C x3 , 99 3 , 99C CIASTO FRA 998924C x5 , 99 5 , 99c PASTA MAX E 52829A 1 x5 , 61 5 , 61A SER MOZZAR 751976c 0 , 304 x33 , 89 10 , 30c AWOKADO 34067C x2 , 95 2 , 95c CHIPSY KET 521902c x4 , 99 4 , 99C KRAJALNI 691060A x8 , 99 8 , 99A ZIEMNIAK 581227c x8 , 98 8 , 98C SZAMPON WL 450850 xl6 , 99 16 , 99A KAPUSTA BIA 2 7891c 1 , 538 x4 , 49 6 , 91c JAJA WOLNY 103729c x7 , 69 7 , 69C BATON PAWE 502905A x2 , 48 2 , 48A Rabat ORZESZKI W 492359c -0 , 80c SPRZEDA≈ª OPODATK 61, 78 PTU 23 , 00 11,55 SPRZEDAZ OPODATK 73 , 65 PTU C 05 , 00 3 , 51 SUMA PTU 15, 0 6 SUMA PLN 135,43 #711 00000711 11:56 Karty plat 135 , 43 PLN Udzielono ≈ÇƒÖcznie rabat√≥w 0 80 Nr transakcji: 0057 Kasa: 711 Kasjer:711 45124711000057030425
[2025-08-17 08:44:54] INFO in chatbot.receipt_processor: PDF text extracted: Xuchan HIPERMARKET AUCHAN 05-270 WARSZAWA MARKI AL J .PI≈ÅSUDSKIEGO TEL _ (0-22) 444 02 22 AUCHAN POLSKA SP Z 0 .0 _ UL PU≈ÅAWSKA 46 , 05-500 PIASECZNO WWW auchan.pl BDO 000013917 NIP: 526-03-09-174 NIEFISKALNY 2025-03-04 ReWtymOplRec551061 x3 , 25 3 , 25A NAPOJ GAZ 86851A x4 , 48 4 , 48A PAROWKI JAL 32107c x6 , 28 6 , 28c PAPIER TOAL 34663A xl9 , 98 19 , 98A MIELONE 571950c xl0 , 98 10 , 98c SANDWICH 958560c x5 , 39 5 , 39C ORZES ZKI 492359C x3 , 99 3 , 99C CIASTO FRA 998924C x5 , 99 5 , 99c PASTA MAX E 52829A 1 x5 , 61 5 , 61A SER MOZZAR 751976c 0 , 304 x33 , 89 10 , 30c AWOKADO 34067C x2 , 95 2 , 95c CHIPSY KET 521902c x4 , 99 4 , 99C KRAJALNI 691060A x8 , 99 8 , 99A ZIEMNIAK 581227c x8 , 98 8 , 98C SZAMPON WL 450850 xl6 , 99 16 , 99A KAPUSTA BIA 2 7891c 1 , 538 x4 , 49 6 , 91c JAJA WOLNY 103729c x7 , 69 7 , 69C BATON PAWE 502905A x2 , 48 2 , 48A Rabat ORZESZKI W 492359c -0 , 80c SPRZEDA≈ª OPODATK 61, 78 PTU 23 , 00 11,55 SPRZEDAZ OPODATK 73 , 65 PTU C 05 , 00 3 , 51 SUMA PTU 15, 0 6 SUMA PLN 135,43 #711 00000711 11:56 Karty plat 135 , 43 PLN Udzielono ≈ÇƒÖcznie rabat√≥w 0 80 Nr transakcji: 0057 Kasa: 711 Kasjer:711 45124711000057030425

[2025-08-17 08:44:54] INFO in chatbot.receipt_processor: ‚úÖ OCR text extraction completed. Extracted 1151 characters
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Extracted text preview: Xuchan HIPERMARKET AUCHAN 05-270 WARSZAWA MARKI AL J .PI≈ÅSUDSKIEGO TEL _ (0-22) 444 02 22 AUCHAN POLSKA SP Z 0 .0 _ UL PU≈ÅAWSKA 46 , 05-500 PIASECZNO WWW auchan.pl BDO 000013917 NIP: 526-03-09-174 NIE...
[2025-08-17 08:44:54] INFO in chatbot.receipt_processor: Receipt 22 status updated to 'ocr_done'
[2025-08-17 08:44:54] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction for receipt 22
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Receipt 22 status updated to 'llm_in_progress'
[2025-08-17 08:44:54] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction...
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Input text length: 1151 characters
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Input text preview: Xuchan HIPERMARKET AUCHAN 05-270 WARSZAWA MARKI AL J .PI≈ÅSUDSKIEGO TEL _ (0-22) 444 02 22 AUCHAN POLSKA SP Z 0 .0 _ UL PU≈ÅAWSKA 46 , 05-500 PIASECZNO WWW auchan.pl BDO 000013917 NIP: 526-03-09-174 NIEFISKALNY 2025-03-04 ReWtymOplRec551061 x3 , 25 3 , 25A NAPOJ GAZ 86851A x4 , 48 4 , 48A PAROWKI JAL ...
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Prepared LLM prompt (length: 2012 chars)
[2025-08-17 08:44:54] INFO in chatbot.receipt_processor: Sending request to LLM model...
[2025-08-17 08:44:54] DEBUG in chatbot.receipt_processor: Initializing OllamaAgent for product extraction...
[2025-08-17 08:44:54] INFO in chatbot.receipt_processor: Calling LLM to process receipt text...
[2025-08-17 08:44:54] ERROR in chatbot.receipt_processor: ‚ùå Unexpected error during LLM product extraction: Client error '404 Not Found' for url 'http://127.0.0.1:11434/api/chat'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 389, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/retry.py", line 105, in call_with_retry
    return do()
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 390, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 803, in _connect
    raise err
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 787, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 127, in reconnect_on_error
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 177, in _consume_from
    self._pubsub.subscribe(key)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 1030, in subscribe
    ret_val = self.execute_command("SUBSCRIBE", *new_channels.keys())
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 860, in execute_command
    self.connection = self.connection_pool.get_connection()
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/utils.py", line 195, in wrapper
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 1533, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 380, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 397, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 389, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/retry.py", line 105, in call_with_retry
    return do()
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 390, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 803, in _connect
    raise err
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 787, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/connection.py", line 472, in _reraise_as_library_errors
    yield
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/base.py", line 929, in send_task
    self.backend.on_task_call(P, task_id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 378, in on_task_call
    self.result_consumer.consume_from(task_id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 169, in consume_from
    return self.start(task_id)
           ~~~~~~~~~~^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 147, in start
    self._consume_from(initial_task_id)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 176, in _consume_from
    with self.reconnect_on_error():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 130, in reconnect_on_error
    self._ensure(self._reconnect_pubsub, ())
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 389, in ensure
    return retry_over_time(
        fun, self.connection_errors, args, {},
        partial(self.on_connection_error, max_retries),
        **retry_policy)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/utils/functional.py", line 318, in retry_over_time
    return fun(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/backends/redis.py", line 106, in _reconnect_pubsub
    metas = self.backend.client.mget(self.subscribed_to)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/commands/core.py", line 1994, in mget
    return self.execute_command("MGET", *args, **options)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 621, in execute_command
    return self._execute_command(*args, **options)
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/client.py", line 627, in _execute_command
    conn = self.connection or pool.get_connection()
                              ~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/utils.py", line 195, in wrapper
    return func(*args, **kwargs)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 1533, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 380, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/redis/connection.py", line 397, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 489, in thread_handler
    raise exc_info[1]
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 489, in thread_handler
    raise exc_info[1]
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/asgiref/sync.py", line 489, in thread_handler
    raise exc_info[1]
  [Previous line repeated 1 more time]
  File "/home/marcin/PycharmProjects/agenty/chatbot/services/receipt_service.py", line 92, in start_processing
    task_result = process_receipt_task.delay(receipt_id)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/task.py", line 444, in delay
    return self.apply_async(args, kwargs)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/task.py", line 601, in apply_async
    return app.send_task(
           ~~~~~~~~~~~~~^
        self.name, args, kwargs, task_id=task_id, producer=producer,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        **options
        ^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/celery/app/base.py", line 927, in send_task
    with P.connection._reraise_as_library_errors():
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/kombu/connection.py", line 476, in _reraise_as_library_errors
    raise ConnectionError(str(exc)) from exc
kombu.exceptions.OperationalError: Error 111 connecting to localhost:6379. Connection refused.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 152, in _extract_products_with_llm
    response = await ollama_agent.process_with_ollama({"message": prompt, "history": []})
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/chatbot/services/agents.py", line 170, in process_with_ollama
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:11434/api/chat'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
[2025-08-17 08:44:54] INFO in chatbot.receipt_processor: LLM processing completed. Found 0 products
[2025-08-17 08:44:54] ERROR in chatbot.receipt_processor: ‚ùå Nie uda≈Ço siƒô wyodrƒôbniƒá produkt√≥w przez LLM.
[2025-08-17 08:44:54] INFO in chatbot.services.receipt_service: ‚úÖ Completed synchronous processing for receipt 22
[2025-08-17 08:44:54] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 22
[2025-08-17 09:12:47] INFO in chatbot.services.receipt_service: Created receipt processing record: 23
[2025-08-17 09:12:47] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 23
[2025-08-17 09:12:47] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 23 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-17 09:12:47] INFO in chatbot.services.receipt_service: Marking receipt 23 as processing...
[2025-08-17 09:12:47] DEBUG in chatbot.services.receipt_service: Receipt 23 status updated to: ocr_in_progress
[2025-08-17 09:12:47] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 23
[2025-08-17 09:12:51] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-17 09:12:51] INFO in chatbot.services.receipt_service: ‚úÖ Celery task started successfully for receipt 23, task ID: 721261e0-0de3-43dd-80be-9d32ca32cc86
[2025-08-17 09:12:51] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 23
[2025-08-17 09:20:10] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 23
[2025-08-17 09:20:10] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-17 09:20:10] INFO in chatbot.receipt_processor: ‚úÖ Found receipt record: 23, current status: ocr_in_progress
[2025-08-17 09:20:10] INFO in chatbot.receipt_processor: Updating receipt 23 status to 'ocr_in_progress'
[2025-08-17 09:20:10] DEBUG in chatbot.receipt_processor: Receipt 23 status updated successfully
[2025-08-17 09:20:10] INFO in chatbot.receipt_processor: Processing file: /home/marcin/PycharmProjects/agenty/media/receipt_files/45124711000057030425_suSAsNf.pdf
[2025-08-17 09:20:10] INFO in chatbot.receipt_processor: File size: 366917 bytes
[2025-08-17 09:20:10] INFO in chatbot.receipt_processor: Detected file type: pdf
[2025-08-17 09:20:10] INFO in chatbot.receipt_processor: üîç Starting text extraction from pdf file...
[2025-08-17 09:20:10] INFO in chatbot.receipt_processor: PDF page 0 has no text, using OCR
[2025-08-17 09:20:10] INFO in chatbot.receipt_processor: üì∑ Starting OCR text extraction from image: /tmp/tmp3oozefp6.png
[2025-08-17 09:20:10] DEBUG in chatbot.receipt_processor: Initializing EasyOCR reader for image processing...
[2025-08-17 09:20:11] ERROR in chatbot.receipt_processor: ‚ùå Error during OCR text extraction from /tmp/tmp3oozefp6.png: Cannot re-initialize CUDA in forked subprocess. To use CUDA with multiprocessing, you must use the 'spawn' start method
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 72, in _extract_text_from_image
    result = self.reader.readtext(image_path)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/easyocr.py", line 456, in readtext
    horizontal_list, free_list = self.detect(img,
                                 ~~~~~~~~~~~^^^^^
                                             min_size = min_size, text_threshold = text_threshold,\
                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
                                             bbox_min_size = bbox_min_size, max_candidates = max_candidates
                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                             )
                                             ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/easyocr.py", line 321, in detect
    text_box_list = self.get_textbox(self.detector,
                                img,
    ...<11 lines>...
                                max_candidates = max_candidates,
                                )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/detection.py", line 95, in get_textbox
    bboxes_list, polys_list = test_net(canvas_size, mag_ratio, detector,
                              ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                       image, text_threshold,
                                       ^^^^^^^^^^^^^^^^^^^^^^
                                       link_threshold, low_text, poly,
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                       device, estimate_num_chars)
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/detection.py", line 42, in test_net
    x = x.to(device)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/torch/cuda/__init__.py", line 398, in _lazy_init
    raise RuntimeError(
    ...<2 lines>...
    )
RuntimeError: Cannot re-initialize CUDA in forked subprocess. To use CUDA with multiprocessing, you must use the 'spawn' start method
[2025-08-17 09:20:11] INFO in chatbot.receipt_processor: PDF text extracted: 
[2025-08-17 09:20:11] ERROR in chatbot.receipt_processor: ‚ùå Nie uda≈Ço siƒô wyodrƒôbniƒá tekstu z pliku paragonu.
[2025-08-17 09:20:11] INFO in chatbot.tasks: Receipt 23 processed successfully by Celery task.
[2025-08-17 09:21:43] INFO in chatbot.services.receipt_service: Created receipt processing record: 24
[2025-08-17 09:21:43] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 24
[2025-08-17 09:21:43] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 24 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-17 09:21:43] INFO in chatbot.services.receipt_service: Marking receipt 24 as processing...
[2025-08-17 09:21:43] DEBUG in chatbot.services.receipt_service: Receipt 24 status updated to: ocr_in_progress
[2025-08-17 09:21:43] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 24
[2025-08-17 09:21:47] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-17 09:21:47] INFO in chatbot.services.receipt_service: ‚úÖ Celery task started successfully for receipt 24, task ID: 98be5afc-2d36-417a-9123-1a3e45af9926
[2025-08-17 09:21:47] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 24
[2025-08-17 09:21:47] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 24
[2025-08-17 09:21:47] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-17 09:21:47] INFO in chatbot.receipt_processor: ‚úÖ Found receipt record: 24, current status: ocr_in_progress
[2025-08-17 09:21:47] INFO in chatbot.receipt_processor: Updating receipt 24 status to 'ocr_in_progress'
[2025-08-17 09:21:47] DEBUG in chatbot.receipt_processor: Receipt 24 status updated successfully
[2025-08-17 09:21:47] INFO in chatbot.receipt_processor: Processing file: /home/marcin/PycharmProjects/agenty/media/receipt_files/Lidl20250131.png
[2025-08-17 09:21:47] INFO in chatbot.receipt_processor: File size: 1076583 bytes
[2025-08-17 09:21:47] INFO in chatbot.receipt_processor: Detected file type: image
[2025-08-17 09:21:47] INFO in chatbot.receipt_processor: üîç Starting text extraction from image file...
[2025-08-17 09:21:47] INFO in chatbot.receipt_processor: üì∑ Starting OCR text extraction from image: /home/marcin/PycharmProjects/agenty/media/receipt_files/Lidl20250131.png
[2025-08-17 09:21:47] DEBUG in chatbot.receipt_processor: Initializing EasyOCR reader for image processing...
[2025-08-17 09:21:47] ERROR in chatbot.receipt_processor: ‚ùå Error during OCR text extraction from /home/marcin/PycharmProjects/agenty/media/receipt_files/Lidl20250131.png: Cannot re-initialize CUDA in forked subprocess. To use CUDA with multiprocessing, you must use the 'spawn' start method
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 72, in _extract_text_from_image
    result = self.reader.readtext(image_path)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/easyocr.py", line 456, in readtext
    horizontal_list, free_list = self.detect(img,
                                 ~~~~~~~~~~~^^^^^
                                             min_size = min_size, text_threshold = text_threshold,\
                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
                                             bbox_min_size = bbox_min_size, max_candidates = max_candidates
                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                             )
                                             ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/easyocr.py", line 321, in detect
    text_box_list = self.get_textbox(self.detector,
                                img,
    ...<11 lines>...
                                max_candidates = max_candidates,
                                )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/detection.py", line 95, in get_textbox
    bboxes_list, polys_list = test_net(canvas_size, mag_ratio, detector,
                              ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                       image, text_threshold,
                                       ^^^^^^^^^^^^^^^^^^^^^^
                                       link_threshold, low_text, poly,
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                       device, estimate_num_chars)
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/detection.py", line 42, in test_net
    x = x.to(device)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/torch/cuda/__init__.py", line 398, in _lazy_init
    raise RuntimeError(
    ...<2 lines>...
    )
RuntimeError: Cannot re-initialize CUDA in forked subprocess. To use CUDA with multiprocessing, you must use the 'spawn' start method
[2025-08-17 09:21:47] ERROR in chatbot.receipt_processor: ‚ùå Nie uda≈Ço siƒô wyodrƒôbniƒá tekstu z pliku paragonu.
[2025-08-17 09:21:47] INFO in chatbot.tasks: Receipt 24 processed successfully by Celery task.
[2025-08-17 09:24:10] INFO in chatbot.services.receipt_service: Created receipt processing record: 25
[2025-08-17 09:24:10] INFO in chatbot.services.receipt_service: üîÑ Starting processing for receipt ID: 25
[2025-08-17 09:24:10] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 25 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-17 09:24:10] INFO in chatbot.services.receipt_service: Marking receipt 25 as processing...
[2025-08-17 09:24:10] DEBUG in chatbot.services.receipt_service: Receipt 25 status updated to: ocr_in_progress
[2025-08-17 09:24:10] INFO in chatbot.services.receipt_service: Attempting to start Celery task for receipt 25
[2025-08-17 09:24:14] DEBUG in chatbot.services.receipt_service: Celery task imported successfully
[2025-08-17 09:24:14] INFO in chatbot.services.receipt_service: ‚úÖ Celery task started successfully for receipt 25, task ID: ff197443-8b8f-474b-973a-eebd26dd2848
[2025-08-17 09:24:14] INFO in chatbot.services.receipt_service: ‚úÖ Processing workflow completed for receipt 25
[2025-08-17 09:24:14] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 25
[2025-08-17 09:24:14] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-17 09:24:14] INFO in chatbot.receipt_processor: ‚úÖ Found receipt record: 25, current status: ocr_in_progress
[2025-08-17 09:24:14] INFO in chatbot.receipt_processor: Updating receipt 25 status to 'ocr_in_progress'
[2025-08-17 09:24:14] DEBUG in chatbot.receipt_processor: Receipt 25 status updated successfully
[2025-08-17 09:24:14] INFO in chatbot.receipt_processor: Processing file: /home/marcin/PycharmProjects/agenty/media/receipt_files/Lidl20250131_05UFjxI.png
[2025-08-17 09:24:14] INFO in chatbot.receipt_processor: File size: 1076583 bytes
[2025-08-17 09:24:14] INFO in chatbot.receipt_processor: Detected file type: image
[2025-08-17 09:24:14] INFO in chatbot.receipt_processor: üîç Starting text extraction from image file...
[2025-08-17 09:24:14] INFO in chatbot.receipt_processor: üì∑ Starting OCR text extraction from image: /home/marcin/PycharmProjects/agenty/media/receipt_files/Lidl20250131_05UFjxI.png
[2025-08-17 09:24:14] DEBUG in chatbot.receipt_processor: Initializing EasyOCR reader for image processing...
[2025-08-17 09:24:14] ERROR in chatbot.receipt_processor: ‚ùå Error during OCR text extraction from /home/marcin/PycharmProjects/agenty/media/receipt_files/Lidl20250131_05UFjxI.png: Cannot re-initialize CUDA in forked subprocess. To use CUDA with multiprocessing, you must use the 'spawn' start method
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 72, in _extract_text_from_image
    result = self.reader.readtext(image_path)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/easyocr.py", line 456, in readtext
    horizontal_list, free_list = self.detect(img,
                                 ~~~~~~~~~~~^^^^^
                                             min_size = min_size, text_threshold = text_threshold,\
                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
                                             bbox_min_size = bbox_min_size, max_candidates = max_candidates
                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                             )
                                             ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/easyocr.py", line 321, in detect
    text_box_list = self.get_textbox(self.detector,
                                img,
    ...<11 lines>...
                                max_candidates = max_candidates,
                                )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/detection.py", line 95, in get_textbox
    bboxes_list, polys_list = test_net(canvas_size, mag_ratio, detector,
                              ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                       image, text_threshold,
                                       ^^^^^^^^^^^^^^^^^^^^^^
                                       link_threshold, low_text, poly,
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                       device, estimate_num_chars)
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/detection.py", line 42, in test_net
    x = x.to(device)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/torch/cuda/__init__.py", line 398, in _lazy_init
    raise RuntimeError(
    ...<2 lines>...
    )
RuntimeError: Cannot re-initialize CUDA in forked subprocess. To use CUDA with multiprocessing, you must use the 'spawn' start method
[2025-08-17 09:24:14] ERROR in chatbot.receipt_processor: ‚ùå Nie uda≈Ço siƒô wyodrƒôbniƒá tekstu z pliku paragonu.
[2025-08-17 09:24:14] INFO in chatbot.tasks: Receipt 25 processed successfully by Celery task.
[2025-08-17 10:03:04] INFO in chatbot.services.receipt_service: Created receipt processing record: 26
[2025-08-17 10:03:04] INFO in chatbot.services.receipt_service: üîÑ Attempting to queue processing for receipt ID: 26
[2025-08-17 10:03:04] DEBUG in chatbot.services.receipt_service: Found receipt: Paragon 26 - Status: Plik przes≈Çany, current status: uploaded
[2025-08-17 10:03:08] INFO in chatbot.services.receipt_service: ‚úÖ Celery task queued successfully for receipt 26, task ID: fa3f1ef7-9582-4ae0-8b2c-7398ac2058ca
[2025-08-17 10:03:08] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 26
[2025-08-17 10:03:08] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-17 10:03:08] INFO in chatbot.receipt_processor: ‚úÖ Found receipt record: 26, current status: ocr_in_progress
[2025-08-17 10:03:08] INFO in chatbot.receipt_processor: Updating receipt 26 status to 'ocr_in_progress'
[2025-08-17 10:03:08] DEBUG in chatbot.receipt_processor: Receipt 26 status updated successfully
[2025-08-17 10:03:08] INFO in chatbot.receipt_processor: Processing file: /home/marcin/PycharmProjects/agenty/media/receipt_files/Lidl20250131_osSgVsC.png
[2025-08-17 10:03:08] INFO in chatbot.receipt_processor: File size: 1076583 bytes
[2025-08-17 10:03:08] INFO in chatbot.receipt_processor: Detected file type: image
[2025-08-17 10:03:08] INFO in chatbot.receipt_processor: üîç Starting text extraction from image file...
[2025-08-17 10:03:08] INFO in chatbot.receipt_processor: üì∑ Starting OCR text extraction from image: /home/marcin/PycharmProjects/agenty/media/receipt_files/Lidl20250131_osSgVsC.png
[2025-08-17 10:03:08] DEBUG in chatbot.receipt_processor: Initializing EasyOCR reader for image processing...
[2025-08-17 10:03:08] ERROR in chatbot.receipt_processor: ‚ùå Error during OCR text extraction from /home/marcin/PycharmProjects/agenty/media/receipt_files/Lidl20250131_osSgVsC.png: Cannot re-initialize CUDA in forked subprocess. To use CUDA with multiprocessing, you must use the 'spawn' start method
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 72, in _extract_text_from_image
    result = self.reader.readtext(image_path)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/easyocr.py", line 456, in readtext
    horizontal_list, free_list = self.detect(img,
                                 ~~~~~~~~~~~^^^^^
                                             min_size = min_size, text_threshold = text_threshold,\
                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
                                             bbox_min_size = bbox_min_size, max_candidates = max_candidates
                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                             )
                                             ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/easyocr.py", line 321, in detect
    text_box_list = self.get_textbox(self.detector,
                                img,
    ...<11 lines>...
                                max_candidates = max_candidates,
                                )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/detection.py", line 95, in get_textbox
    bboxes_list, polys_list = test_net(canvas_size, mag_ratio, detector,
                              ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                       image, text_threshold,
                                       ^^^^^^^^^^^^^^^^^^^^^^
                                       link_threshold, low_text, poly,
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                       device, estimate_num_chars)
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/easyocr/detection.py", line 42, in test_net
    x = x.to(device)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/torch/cuda/__init__.py", line 398, in _lazy_init
    raise RuntimeError(
    ...<2 lines>...
    )
RuntimeError: Cannot re-initialize CUDA in forked subprocess. To use CUDA with multiprocessing, you must use the 'spawn' start method
[2025-08-17 10:03:08] ERROR in chatbot.receipt_processor: ‚ùå Nie uda≈Ço siƒô wyodrƒôbniƒá tekstu z pliku paragonu.
[2025-08-17 10:03:08] INFO in chatbot.tasks: ‚úÖ Receipt 26 processed successfully by Celery task.
[2025-08-17 13:29:54] INFO in chatbot.services.receipt_service: Created receipt processing record: 1
[2025-08-17 13:29:54] INFO in chatbot.services.receipt_service: Created receipt processing record: 1
[2025-08-17 13:29:54] INFO in chatbot.services.receipt_service: Created receipt processing record: 1
[2025-08-17 13:29:54] INFO in chatbot.services.receipt_service: Created receipt processing record: 1
[2025-08-17 13:29:54] INFO in chatbot.services.receipt_service: Created receipt processing record: 1
[2025-08-17 13:30:30] INFO in chatbot.services.receipt_service: Created receipt processing record: 1
[2025-08-17 13:31:23] INFO in chatbot.services.receipt_service: Created receipt processing record: 1
[2025-08-17 13:31:23] INFO in chatbot.services.receipt_service: Created receipt processing record: 1
[2025-08-17 13:31:39] INFO in chatbot.services.receipt_service: Created receipt processing record: 1
[2025-08-17 13:31:39] ERROR in chatbot.services.receipt_service: Receipt 1 not found
[2025-08-17 13:32:05] ERROR in chatbot.services.receipt_service: Receipt 1 not found
[2025-08-17 13:32:15] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 1: /fake/receipt.pdf
[2025-08-17 13:32:15] ERROR in chatbot.services.receipt_service: OCR failed for receipt 1: Could not extract text
[2025-08-17 13:32:15] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 1: /fake/receipt.pdf
[2025-08-17 13:32:15] ERROR in chatbot.services.receipt_service: No OCR backends available
[2025-08-17 13:32:15] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 1: /fake/receipt.pdf
[2025-08-17 13:32:15] INFO in chatbot.services.receipt_service: OCR completed for receipt 1: 42 characters extracted
[2025-08-17 20:53:10] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction...
[2025-08-17 20:53:10] DEBUG in chatbot.receipt_processor: Input text length: 117 characters
[2025-08-17 20:53:10] DEBUG in chatbot.receipt_processor: Input text preview: Sklep ABC
    Data: 2025-08-17
    Mleko 2% - 1 szt - 3.50 PLN
    Chleb razowy - 1 szt - 4.20 PLN
    Suma: 7.70 PLN...
[2025-08-17 20:53:10] DEBUG in chatbot.receipt_processor: Prepared LLM prompt (length: 1366 chars)
[2025-08-17 20:53:10] INFO in chatbot.receipt_processor: Sending request to LLM model...
[2025-08-17 20:53:10] INFO in chatbot.receipt_processor: Using agent 'Asystent Og√≥lny' for receipt extraction.
[2025-08-17 20:53:10] INFO in chatbot.receipt_processor: Calling LLM to process receipt text...
[2025-08-17 20:53:15] INFO in chatbot.receipt_processor: ‚úÖ LLM response received (length: 149 chars)
[2025-08-17 20:53:15] DEBUG in chatbot.receipt_processor: LLM raw response: ```json
[
    {"product_name": "Mleko 2%", "quantity": 1.0, "unit": "l"},
    {"product_name": "Chleb razowy", "quantity": 1.0, "unit": "szt."}
]
```
[2025-08-17 20:53:15] INFO in chatbot.receipt_processor: Parsing JSON from LLM response's markdown block...
[2025-08-17 20:53:15] DEBUG in chatbot.receipt_processor: Extracted JSON string: [
    {"product_name": "Mleko 2%", "quantity": 1.0, "unit": "l"},
    {"product_name": "Chleb razowy", "quantity": 1.0, "unit": "szt."}
]
[2025-08-17 20:53:15] INFO in chatbot.receipt_processor: ‚úÖ Successfully parsed and validated 2 products from LLM response
[2025-08-17 20:53:36] INFO in chatbot.receipt_processor: üîÑ STARTING OCR PROCESSING for receipt ID: 19
[2025-08-17 20:53:36] DEBUG in chatbot.receipt_processor: Fetching receipt record from database...
[2025-08-17 20:53:36] INFO in chatbot.receipt_processor: ‚úÖ Found receipt record: 19, current status: error
[2025-08-17 20:53:36] INFO in chatbot.receipt_processor: Updating receipt 19 status to 'ocr_in_progress'
[2025-08-17 20:53:36] DEBUG in chatbot.receipt_processor: Receipt 19 status updated successfully
[2025-08-17 20:53:36] INFO in chatbot.receipt_processor: Processing file: /home/marcin/PycharmProjects/agenty/media/receipt_files/Lidl20250131_osSgVsC.png
[2025-08-17 20:53:36] INFO in chatbot.receipt_processor: File size: 1076583 bytes
[2025-08-17 20:53:36] INFO in chatbot.receipt_processor: Detected file type: image
[2025-08-17 20:53:36] INFO in chatbot.receipt_processor: üîç Starting text extraction from image file...
[2025-08-17 20:53:36] INFO in chatbot.receipt_processor: üì∑ Starting OCR text extraction from image: /home/marcin/PycharmProjects/agenty/media/receipt_files/Lidl20250131_osSgVsC.png
[2025-08-17 20:53:36] DEBUG in chatbot.receipt_processor: Initializing EasyOCR reader for image processing...
[2025-08-17 20:53:38] INFO in chatbot.receipt_processor: EasyOCR detected 232 text regions
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 1: 'Lidl sp' (confidence: 0.95)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 2: 'Z . 0' (confidence: 0.87)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 3: 'sp' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 4: 'Pozna≈Ñska' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 5: '48' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 6: 'Jankowice' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 7: '62-080' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 8: 'Tarnowo Podg√≥rne' (confidence: 0.98)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 9: 'WWW' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 10: 'lidl' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 11: 'pl' (confidence: 0.99)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 12: '2025-01-31' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 13: 'Skyr pitny' (confidence: 0.98)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 14: 'natural' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 15: '99' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 16: 'Krem' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 17: 'czekoladowy' (confidence: 0.99)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 18: '99' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 19: 'Ciecierzyca' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 20: '540g' (confidence: 0.67)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 21: '6,49' (confidence: 0.89)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 22: 'KurczakBiesiad' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 23: 'Fi' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 24: '616' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 25: '36' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 26: '74' (confidence: 0.83)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 27: '22 , 63' (confidence: 0.55)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 28: 'Lidl Plus' (confidence: 0.93)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 29: 'rabat' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 30: 'Twaro≈ºek' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 31: 'Grani' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 32: '59' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 33: '18' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 34: 'Smietana' (confidence: 0.98)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 35: '18%' (confidence: 0.87)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 36: '200g' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 37: '2, 29' (confidence: 0.87)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 38: '29' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 39: 'KinderB WHITEwafelki' (confidence: 0.99)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 40: '3 , 79' (confidence: 0.83)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 41: '950' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 42: 'kinder' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 43: 'Przyprawa' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 44: 'm≈Çynkach' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 45: '99' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 46: 'Bu≈Çka grahamka' (confidence: 0.96)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 47: '69' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 48: 'Banany' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 49: 'luz' (confidence: 0.88)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 50: '732' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 51: '99' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 52: 'Lidl Plus' (confidence: 0.98)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 53: 'rabat' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 54: 'Kiwi' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 55: 'szt' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 56: '99' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 57: 'Lidl' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 58: 'Plus' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 59: 'rabat' (confidence: 0.65)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 60: 'Jaja ≈õci√≥≈Çkowe' (confidence: 0.71)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 61: '2' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 62: '49 18,98' (confidence: 0.70)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 63: 'idl' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 64: 'Plus' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 65: 'rabat' (confidence: 0.96)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 66: 'PTU' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 67: '14 , 98' (confidence: 0.89)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 68: 'Kwota' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 69: '23 , 00%' (confidence: 0.92)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 70: '80' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 71: 'PTU' (confidence: 0.99)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 72: '68' (confidence: 0.91)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 73: '07' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 74: 'Kwota' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 75: '00%' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 76: 'Suma' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 77: '04' (confidence: 0.60)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 78: 'Razem' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 79: '83 ,05' (confidence: 0.57)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 80: '85 2009' (confidence: 0.89)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 81: 'nr:' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 82: '22452' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 83: ':57' (confidence: 0.99)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 84: 'P≈Çatno≈õƒá' (confidence: 0.97)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 85: 'Karta' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 86: 'p≈Çatnicza' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 87: '83 ,05' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 88: 'RAZEM' (confidence: 0.81)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 89: 'PLN' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 90: '83' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 91: '0' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 92: 'Aby zwr√≥ciƒá produkt; we≈∫' (confidence: 0.74)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 93: 'sobƒÖ' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 94: 'oryginalne opakowanie: Na zwrot' (confidence: 0.68)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 95: 'produkt√≥w przemys≈Çowych masz 30 dni od' (confidence: 0.85)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 96: 'datv' (confidence: 0.73)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 97: 'zakupu.' (confidence: 0.68)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 98: 'Kwota do zap≈Çaty uwzglƒôdnia ewentualnƒÖ' (confidence: 0.96)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 99: 'kaucjƒô' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 100: 'opakowania, niewyszczeg√≥lnionƒÖ' (confidence: 0.68)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 101: 'cenie towaru.' (confidence: 0.54)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 102: 'Oce≈Ñ nas' (confidence: 0.68)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 103: 'zdobƒÖd≈∫ szansƒô na wygranƒÖ' (confidence: 0.96)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 104: 'Loterii Lidla!' (confidence: 0.71)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 105: 'Ankieta' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 106: 'regulamin loterii dostƒôpne na' (confidence: 0.88)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 107: 'lidlpl/twoja-opinia' (confidence: 0.75)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 108: 'Adres siedziby sprzedawcy:' (confidence: 0.99)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 109: 'Pozna≈Ñska 48, Jankowice' (confidence: 0.77)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 110: '62-080 Tarnowo Podg√≥rne' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 111: 'www.lidlpl' (confidence: 0.56)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 112: 'Zakup' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 113: 'kartƒÖ' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 114: '************4939' (confidence: 0.96)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 115: 'Wykorzystane kupony' (confidence: 0.89)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 116: '50% TANIEJ' (confidence: 0.80)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 117: 'Banany' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 118: 'luzem' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 119: 'Kupon obowiƒÖzuje TYLKO 31.01.2025 lub do' (confidence: 0.87)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 120: 'wyczerpania zapas√≥w we' (confidence: 0.81)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 121: 'wszystkich' (confidence: 0.73)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 122: 'stacjonarnych sklepach Lidl na' (confidence: 0.94)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 123: 'terenie' (confidence: 0.79)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 124: 'Polski.' (confidence: 0.98)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 125: 'Kupon mo≈ºna wykorzystaƒá' (confidence: 0.83)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 126: 'raz' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 127: 'Rabat' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 128: 'nalicza siƒô' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 129: 'minimalnie 100' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 130: 'maksymalnie' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 131: 'kg. Ilo≈õƒá powy≈ºej' (confidence: 0.90)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 132: 'kg' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 133: 'sprzedawana' (confidence: 0.76)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 134: 'ceni' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 135: 'obni≈ºkƒÖ:' (confidence: 0.97)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 136: 'Abv otrzvmaƒá rabat:' (confidence: 0.98)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 137: 'aktywuj kupon,' (confidence: 0.87)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 138: 'wybierz produkty' (confidence: 0.94)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 139: 'promocjƒÖ,' (confidence: 0.85)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 140: 'zeskanu' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 141: 'cyfrowa' (confidence: 0.80)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 142: 'Kartƒô Lidl Plus przy kasie' (confidence: 0.80)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 143: 'Cena' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 144: 'obni≈ºkƒÖ' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 145: 'cena poza' (confidence: 0.69)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 146: 'promocjƒÖ: 6,99' (confidence: 0.74)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 147: 'z≈Ç / kg' (confidence: 0.84)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 148: 'Cena' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 149: 'kuponem: 3,49' (confidence: 0.72)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 150: 'kg' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 151: '50% TANIEJ' (confidence: 0.91)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 152: 'Kiwi' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 153: 'sztuka' (confidence: 0.72)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 154: 'Kupon obowiazuje od' (confidence: 0.71)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 155: '30.01.2025 do 01.02.2025' (confidence: 0.65)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 156: 'lub do wyczerpania zapas√≥w; we' (confidence: 0.64)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 157: 'wszystkich' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 158: 'stacionarnych sklepach' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 159: 'Lidl na terenie Polski.' (confidence: 0.85)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 160: 'Kupon mo≈ºna' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 161: 'wykorzystaƒá tylko raz.' (confidence: 0.87)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 162: 'Rabat' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 163: 'zostanie naliczony na maksymalnie' (confidence: 0.62)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 164: 'sztuk przy' (confidence: 0.79)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 165: 'jednorazowym zakupie' (confidence: 0.90)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 166: 'Abv otrzyvmaƒá rabat:' (confidence: 0.56)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 167: 'aktywuj kupon' (confidence: 0.85)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 168: 'wybierz produkty objƒôte promocjƒÖ,' (confidence: 0.77)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 169: 'zeskanuj cyfrowƒÖ Kartƒô Lidl Plus przy kasie.' (confidence: 0.93)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 170: 'Cena przed obni≈ºkƒÖ' (confidence: 0.96)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 171: 'cena poza' (confidence: 0.69)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 172: 'promocia:' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 173: ',99' (confidence: 0.62)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 174: 'z≈Ç ,' (confidence: 0.96)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 175: 'szt.' (confidence: 0.72)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 176: 'Cena' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 177: 'kuponem: 0,99 z≈Ç' (confidence: 0.99)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 178: 'szt.' (confidence: 0.98)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 179: '50% TANIEJ PRZY ZAKUPIE' (confidence: 0.48)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 180: 'OPAK' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 181: 'Jajka' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 182: '≈õci√≥≈Çkowe wielko≈õƒá M' (confidence: 0.75)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 183: 'Kupon obowi' (confidence: 0.72)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 184: 'uje od 30.01.2025 do' (confidence: 0.63)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 185: '02.2025' (confidence: 0.89)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 186: 'lub do wyczerpania zapas√≥w, we wszystkich' (confidence: 0.77)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 187: 'stacionarnych sklepach' (confidence: 0.89)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 188: 'Lidl na' (confidence: 0.76)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 189: 'terenie Polski.' (confidence: 0.83)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 190: 'Kupon mo≈ºna wykorzystaƒá tylko raz.' (confidence: 0.73)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 191: 'celu' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 192: 'otrzymania rabatu nale≈ºy zakupiƒá' (confidence: 0.67)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 193: 'opakowania' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 194: 'Rabat zostanie naliczony' (confidence: 0.92)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 195: 'ka≈ºde' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 196: 'opakowa≈Ñ' (confidence: 0.61)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 197: 'przy jednorazowym zakupie' (confidence: 0.84)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 198: 'Limit zakupu' (confidence: 0.83)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 199: 'rabatem:' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 200: 'opakowania' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 201: 'Aby otrzymaƒá rabat:' (confidence: 0.79)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 202: 'aktywuj kupon;' (confidence: 0.87)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 203: 'wybierz produkty objƒôte promocjƒÖ' (confidence: 0.99)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 204: 'zeskanuj cyfrowƒÖ Kartƒô Lidl' (confidence: 0.97)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 205: 'przy kasie' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 206: 'zakupie' (confidence: 0.99)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 207: 'opakowa≈Ñ' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 208: 'kuponem' (confidence: 0.57)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 209: 'idl -' (confidence: 0.25)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 210: 'przed obni≈ºkƒÖ _' (confidence: 0.73)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 211: 'cena poza' (confidence: 0.60)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 212: 'promocja:' (confidence: 0.93)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 213: ',49' (confidence: 0.52)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 214: 'opak.' (confidence: 0.88)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 215: 'Cena' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 216: 'kuponem: 4,69 z≈Ç / opak' (confidence: 0.94)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 217: 'Miejsce' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 218: 'zakupu' (confidence: 0.99)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 219: 'Warszawa, ul_' (confidence: 0.61)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 220: 'Radzymi≈Ñska' (confidence: 0.99)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 221: 'Radzymi≈Ñska' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 222: '03-694 Warszawa' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 223: 'Szczeg√≥≈Çy sklepu' (confidence: 0.73)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 224: 'tylko' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 225: 'bƒôdzie' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 226: 'przed' (confidence: 0.89)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 227: 'objƒôte' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 228: 'przed' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 229: 'Plus' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 230: 'Przy' (confidence: 1.00)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 231: 'Plus:' (confidence: 0.99)
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Region 232: 'Cena' (confidence: 1.00)
[2025-08-17 20:53:38] INFO in chatbot.receipt_processor: ‚úÖ OCR extraction completed. Total text length: 2638 characters
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: OCR extracted text: Lidl sp Z . 0 sp Pozna≈Ñska 48 Jankowice 62-080 Tarnowo Podg√≥rne WWW lidl pl 2025-01-31 Skyr pitny natural 99 Krem czekoladowy 99 Ciecierzyca 540g 6,49 KurczakBiesiad Fi 616 36 74 22 , 63 Lidl Plus rabat Twaro≈ºek Grani 59 18 Smietana 18% 200g 2, 29 29 KinderB WHITEwafelki 3 , 79 950 kinder Przyprawa m≈Çynkach 99 Bu≈Çka grahamka 69 Banany luz 732 99 Lidl Plus rabat Kiwi szt 99 Lidl Plus rabat Jaja ≈õci√≥≈Çkowe 2 49 18,98 idl Plus rabat PTU 14 , 98 Kwota 23 , 00% 80 PTU 68 07 Kwota 00% Suma 04 Razem 83 ,05 85 2009 nr: 22452 :57 P≈Çatno≈õƒá Karta p≈Çatnicza 83 ,05 RAZEM PLN 83 0 Aby zwr√≥ciƒá produkt; we≈∫ sobƒÖ oryginalne opakowanie: Na zwrot produkt√≥w przemys≈Çowych masz 30 dni od datv zakupu. Kwota do zap≈Çaty uwzglƒôdnia ewentualnƒÖ kaucjƒô opakowania, niewyszczeg√≥lnionƒÖ cenie towaru. Oce≈Ñ nas zdobƒÖd≈∫ szansƒô na wygranƒÖ Loterii Lidla! Ankieta regulamin loterii dostƒôpne na lidlpl/twoja-opinia Adres siedziby sprzedawcy: Pozna≈Ñska 48, Jankowice 62-080 Tarnowo Podg√≥rne www.lidlpl Zakup kartƒÖ ************4939 Wykorzystane kupony 50% TANIEJ Banany luzem Kupon obowiƒÖzuje TYLKO 31.01.2025 lub do wyczerpania zapas√≥w we wszystkich stacjonarnych sklepach Lidl na terenie Polski. Kupon mo≈ºna wykorzystaƒá raz Rabat nalicza siƒô minimalnie 100 maksymalnie kg. Ilo≈õƒá powy≈ºej kg sprzedawana ceni obni≈ºkƒÖ: Abv otrzvmaƒá rabat: aktywuj kupon, wybierz produkty promocjƒÖ, zeskanu cyfrowa Kartƒô Lidl Plus przy kasie Cena obni≈ºkƒÖ cena poza promocjƒÖ: 6,99 z≈Ç / kg Cena kuponem: 3,49 kg 50% TANIEJ Kiwi sztuka Kupon obowiazuje od 30.01.2025 do 01.02.2025 lub do wyczerpania zapas√≥w; we wszystkich stacionarnych sklepach Lidl na terenie Polski. Kupon mo≈ºna wykorzystaƒá tylko raz. Rabat zostanie naliczony na maksymalnie sztuk przy jednorazowym zakupie Abv otrzyvmaƒá rabat: aktywuj kupon wybierz produkty objƒôte promocjƒÖ, zeskanuj cyfrowƒÖ Kartƒô Lidl Plus przy kasie. Cena przed obni≈ºkƒÖ cena poza promocia: ,99 z≈Ç , szt. Cena kuponem: 0,99 z≈Ç szt. 50% TANIEJ PRZY ZAKUPIE OPAK Jajka ≈õci√≥≈Çkowe wielko≈õƒá M Kupon obowi uje od 30.01.2025 do 02.2025 lub do wyczerpania zapas√≥w, we wszystkich stacionarnych sklepach Lidl na terenie Polski. Kupon mo≈ºna wykorzystaƒá tylko raz. celu otrzymania rabatu nale≈ºy zakupiƒá opakowania Rabat zostanie naliczony ka≈ºde opakowa≈Ñ przy jednorazowym zakupie Limit zakupu rabatem: opakowania Aby otrzymaƒá rabat: aktywuj kupon; wybierz produkty objƒôte promocjƒÖ zeskanuj cyfrowƒÖ Kartƒô Lidl przy kasie zakupie opakowa≈Ñ kuponem idl - przed obni≈ºkƒÖ _ cena poza promocja: ,49 opak. Cena kuponem: 4,69 z≈Ç / opak Miejsce zakupu Warszawa, ul_ Radzymi≈Ñska Radzymi≈Ñska 03-694 Warszawa Szczeg√≥≈Çy sklepu tylko bƒôdzie przed objƒôte przed Plus Przy Plus: Cena
[2025-08-17 20:53:38] INFO in chatbot.receipt_processor: ‚úÖ OCR text extraction completed. Extracted 2638 characters
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Extracted text preview: Lidl sp Z . 0 sp Pozna≈Ñska 48 Jankowice 62-080 Tarnowo Podg√≥rne WWW lidl pl 2025-01-31 Skyr pitny natural 99 Krem czekoladowy 99 Ciecierzyca 540g 6,49 KurczakBiesiad Fi 616 36 74 22 , 63 Lidl Plus rab...
[2025-08-17 20:53:38] INFO in chatbot.receipt_processor: Receipt 19 status updated to 'ocr_done'
[2025-08-17 20:53:38] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction for receipt 19
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Receipt 19 status updated to 'llm_in_progress'
[2025-08-17 20:53:38] INFO in chatbot.receipt_processor: ü§ñ Starting LLM product extraction...
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Input text length: 2638 characters
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Input text preview: Lidl sp Z . 0 sp Pozna≈Ñska 48 Jankowice 62-080 Tarnowo Podg√≥rne WWW lidl pl 2025-01-31 Skyr pitny natural 99 Krem czekoladowy 99 Ciecierzyca 540g 6,49 KurczakBiesiad Fi 616 36 74 22 , 63 Lidl Plus rabat Twaro≈ºek Grani 59 18 Smietana 18% 200g 2, 29 29 KinderB WHITEwafelki 3 , 79 950 kinder Przyprawa ...
[2025-08-17 20:53:38] DEBUG in chatbot.receipt_processor: Prepared LLM prompt (length: 3887 chars)
[2025-08-17 20:53:38] INFO in chatbot.receipt_processor: Sending request to LLM model...
[2025-08-17 20:53:38] INFO in chatbot.receipt_processor: Using agent 'Asystent Og√≥lny' for receipt extraction.
[2025-08-17 20:53:38] INFO in chatbot.receipt_processor: Calling LLM to process receipt text...
[2025-08-17 20:53:39] ERROR in chatbot.receipt_processor: ‚ùå Unexpected error during LLM product extraction: Server error '500 Internal Server Error' for url 'http://127.0.0.1:11434/api/chat'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 183, in _extract_products_with_llm
    response = await ollama_agent.process_with_ollama({"message": prompt, "history": []})
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/chatbot/services/agents.py", line 170, in process_with_ollama
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Server error '500 Internal Server Error' for url 'http://127.0.0.1:11434/api/chat'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500
[2025-08-17 20:53:39] ERROR in chatbot.receipt_processor: ‚ùå CRITICAL ERROR during receipt processing for ID 19: Server error '500 Internal Server Error' for url 'http://127.0.0.1:11434/api/chat'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 310, in process_receipt
    products_data = await self._extract_products_with_llm(receipt_text)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/chatbot/receipt_processor.py", line 183, in _extract_products_with_llm
    response = await ollama_agent.process_with_ollama({"message": prompt, "history": []})
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/chatbot/services/agents.py", line 170, in process_with_ollama
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Server error '500 Internal Server Error' for url 'http://127.0.0.1:11434/api/chat'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500
[2025-08-17 20:53:39] INFO in chatbot.receipt_processor: Marked receipt 19 as error in database
[2025-08-17 20:59:04] INFO in chatbot.tasks: ‚ñ∂Ô∏è STARTING NEW PROCESSING ORCHESTRATION for Receipt ID: 29
[2025-08-17 20:59:04] INFO in chatbot.tasks:   [1/3] OCR | Receipt ID: 29
[2025-08-17 20:59:04] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 29: 
[2025-08-17 20:59:06] ERROR in chatbot.services.receipt_service: OCR failed for receipt 29: Unsupported file type: 
[2025-08-17 20:59:06] ERROR in chatbot.tasks:   [1/3] OCR FAILED | Receipt ID: 29
[2025-08-17 21:03:54] INFO in chatbot.tasks: ‚ñ∂Ô∏è STARTING NEW PROCESSING ORCHESTRATION for Receipt ID: 31
[2025-08-17 21:03:54] INFO in chatbot.tasks:   [1/3] OCR | Receipt ID: 31
[2025-08-17 21:03:54] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 31: 
[2025-08-17 21:03:56] ERROR in chatbot.services.receipt_service: OCR failed for receipt 31: Unsupported file type: 
[2025-08-17 21:03:56] ERROR in chatbot.tasks:   [1/3] OCR FAILED | Receipt ID: 31
[2025-08-17 21:06:30] INFO in chatbot.tasks: ‚ñ∂Ô∏è STARTING NEW PROCESSING ORCHESTRATION for Receipt ID: 32
[2025-08-17 21:06:30] INFO in chatbot.tasks:   [1/3] OCR | Receipt ID: 32
[2025-08-17 21:06:30] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 32: 
[2025-08-17 21:06:30] ERROR in chatbot.services.receipt_service: OCR failed for receipt 32: Unsupported file type: 
[2025-08-17 21:06:30] ERROR in chatbot.tasks:   [1/3] OCR FAILED | Receipt ID: 32
[2025-08-17 21:10:30] INFO in chatbot.tasks: ‚ñ∂Ô∏è STARTING NEW PROCESSING ORCHESTRATION for Receipt ID: 33
[2025-08-17 21:10:30] INFO in chatbot.tasks:   [1/3] OCR | Receipt ID: 33
[2025-08-17 21:10:30] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 33: 
[2025-08-17 21:10:32] ERROR in chatbot.services.receipt_service: OCR failed for receipt 33: Unsupported file type: 
[2025-08-17 21:10:32] ERROR in chatbot.tasks:   [1/3] OCR FAILED | Receipt ID: 33
[2025-08-17 21:13:10] INFO in chatbot.tasks: ‚ñ∂Ô∏è STARTING NEW PROCESSING ORCHESTRATION for Receipt ID: 34
[2025-08-17 21:13:10] INFO in chatbot.tasks:   [1/3] OCR | Receipt ID: 34
[2025-08-17 21:13:10] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 34: 
[2025-08-17 21:13:12] ERROR in chatbot.services.receipt_service: OCR failed for receipt 34: Unsupported file type: 
[2025-08-17 21:13:12] ERROR in chatbot.tasks:   [1/3] OCR FAILED | Receipt ID: 34
[2025-08-17 21:35:11] INFO in chatbot.tasks: ‚ñ∂Ô∏è STARTING NEW PROCESSING ORCHESTRATION for Receipt ID: 36
[2025-08-17 21:35:11] INFO in chatbot.tasks:   [1/3] OCR | Receipt ID: 36
[2025-08-17 21:35:11] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 36: 
[2025-08-17 21:35:13] ERROR in chatbot.services.receipt_service: OCR failed for receipt 36: Unsupported file type: 
[2025-08-17 21:35:13] ERROR in chatbot.tasks:   [1/3] OCR FAILED | Receipt ID: 36
[2025-08-17 21:37:42] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 36: /home/marcin/PycharmProjects/agenty/media/receipt_files/45124711000057030425_h1esizo.pdf
[2025-08-17 21:37:52] ERROR in chatbot.services.receipt_service: OCR failed for receipt 36: All OCR backends failed. Last error: document closed
[2025-08-17 21:38:03] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 37: /home/marcin/PycharmProjects/agenty/media/receipt_files/test_lidl.png
[2025-08-17 21:38:14] ERROR in chatbot.services.receipt_service: Error during OCR processing for receipt 37: Object of type int32 is not JSON serializable
Traceback (most recent call last):
  File "/home/marcin/PycharmProjects/agenty/chatbot/services/receipt_service.py", line 344, in process_receipt_ocr
    receipt.save()
    ~~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
    ~~~~~~~~~~~~~~^
        using=using,
        ^^^^^^^^^^^^
    ...<2 lines>...
        update_fields=update_fields,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
        raw,
    ...<4 lines>...
        update_fields,
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
        base_qs, using, pk_val, values, update_fields, forced_update
    )
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 1610, in execute_sql
    sql, params = self.as_sql()
                  ~~~~~~~~~~~^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 2023, in as_sql
    val = field.get_db_prep_save(val, connection=self.connection)
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/fields/json.py", line 118, in get_db_prep_save
    return super().get_db_prep_save(value, connection)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/fields/__init__.py", line 1012, in get_db_prep_save
    return self.get_db_prep_value(value, connection=connection, prepared=False)
           ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/models/fields/json.py", line 102, in get_db_prep_value
    return connection.ops.adapt_json_value(value, self.encoder)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/PycharmProjects/agenty/.venv/lib/python3.13/site-packages/django/db/backends/base/operations.py", line 598, in adapt_json_value
    return json.dumps(value, cls=encoder)
           ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "/usr/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/usr/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/usr/lib/python3.13/json/encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
                    f'is not JSON serializable')
TypeError: Object of type int32 is not JSON serializable
[2025-08-17 21:38:53] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 38: /home/marcin/PycharmProjects/agenty/media/receipt_files/test_lidl_fixed.png
[2025-08-17 21:39:04] INFO in chatbot.services.receipt_service: OCR completed for receipt 38: 2638 characters extracted
[2025-08-17 21:39:25] INFO in chatbot.tasks: ‚ñ∂Ô∏è STARTING NEW PROCESSING ORCHESTRATION for Receipt ID: 39
[2025-08-17 21:39:25] INFO in chatbot.tasks:   [1/3] OCR | Receipt ID: 39
[2025-08-17 21:39:25] INFO in chatbot.services.receipt_service: Starting OCR processing for receipt 39: /home/marcin/PycharmProjects/agenty/media/receipt_files/final_test.png
[2025-08-17 21:39:36] INFO in chatbot.services.receipt_service: OCR completed for receipt 39: 2638 characters extracted
[2025-08-17 21:39:36] INFO in chatbot.tasks:   [2/3] PARSING | Receipt ID: 39
[2025-08-17 21:39:36] INFO in chatbot.services.receipt_service: Starting parsing for receipt 39: 2638 characters
[2025-08-17 21:39:36] INFO in chatbot.services.receipt_service: Parsing completed for receipt 39: 0 products extracted
[2025-08-17 21:39:36] INFO in chatbot.tasks:   [3/3] MATCHING | Receipt ID: 39
[2025-08-17 21:39:36] ERROR in chatbot.services.receipt_service: Receipt 39 has no products in parsed data
[2025-08-17 21:39:36] ERROR in chatbot.tasks:   [3/3] MATCHING FAILED | Receipt ID: 39

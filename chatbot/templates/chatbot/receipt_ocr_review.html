{% extends 'chatbot/base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header Section -->
        <div class="text-center mb-8 animate-fade-in">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mb-4 shadow-lg">
                <span class="text-3xl">üìù</span>
            </div>
            <h1 class="text-4xl font-bold gradient-text mb-2">{{ title }}</h1>
            <p class="text-secondary-600 text-lg">Sprawd≈∫ i popraw rozpoznany tekst przed kontynuacjƒÖ przetwarzania</p>
        </div>

        <!-- OCR Review Card -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border border-secondary-100">
            <div class="mb-6">
                <h3 class="text-xl font-semibold text-secondary-800 mb-4 flex items-center">
                    <span class="text-2xl mr-2">üîç</span>
                    Rozpoznany tekst z paragonu
                </h3>
                <p class="text-secondary-600 text-sm mb-4">
                    Sprawd≈∫ czy AI poprawnie rozpozna≈Ça tekst. Mo≈ºesz edytowaƒá tekst je≈õli zauwa≈ºysz b≈Çƒôdy,
                    kt√≥re mog≈Çyby wp≈ÇynƒÖƒá na poprawne rozpoznanie produkt√≥w.
                </p>
            </div>

            <!-- OCR Text Editor -->
            <form method="post" id="ocr-review-form" class="space-y-6">
                {% csrf_token %}
                <div class="space-y-2">
                    <label for="id_ocr_text" class="block text-sm font-semibold text-secondary-700">
                        Tekst paragonu (mo≈ºesz edytowaƒá):
                    </label>
                    <textarea
                        name="ocr_text"
                        id="id_ocr_text"
                        rows="12"
                        class="w-full px-4 py-3 border border-secondary-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 resize-vertical font-mono text-sm"
                        placeholder="Wklej lub wpisz tekst paragonu..."
                    >{{ ocr_text|default:"" }}</textarea>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 pt-4">
                    <button type="submit" id="continue-btn"
                            class="flex-1 bg-gradient-to-r from-primary-500 to-purple-600 hover:from-primary-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 flex items-center justify-center space-x-2">
                        <span class="text-xl">‚úÖ</span>
                        <span>Potwierd≈∫ i kontynuuj</span>
                    </button>

                    <button type="button" id="skip-btn"
                            class="flex-1 bg-secondary-100 hover:bg-secondary-200 text-secondary-700 font-medium py-3 px-6 rounded-xl transition-all duration-300 border border-secondary-300">
                        <span>Pomi≈Ñ (u≈ºyj bez zmian)</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- Help Section -->
        <div class="bg-blue-50 rounded-2xl p-6 mb-6 border border-blue-200">
            <h3 class="text-lg font-semibold text-blue-800 mb-4 flex items-center">
                <span class="text-xl mr-2">üí°</span>
                Wskaz√≥wki dotyczƒÖce edycji tekstu
            </h3>
            <div class="space-y-2 text-blue-700 text-sm">
                <p>‚Ä¢ <strong>Popraw b≈Çƒôdy OCR:</strong> Napraw litery, kt√≥re zosta≈Çy b≈Çƒôdnie rozpoznane</p>
                <p>‚Ä¢ <strong>Usu≈Ñ szum:</strong> Usu≈Ñ nag≈Ç√≥wki, stopki i inne nieistotne informacje</p>
                <p>‚Ä¢ <strong>Zachowaj strukturƒô:</strong> Staraj siƒô utrzymaƒá formatowanie produkt√≥w (nazwa + cena)</p>
                <p>‚Ä¢ <strong>Przyk≈Çady format√≥w:</strong></p>
                <ul class="ml-4 mt-2 space-y-1">
                    <li>‚Ä¢ Mleko 2% 2L - 4,99 z≈Ç</li>
                    <li>‚Ä¢ Chleb razowy - 3,50</li>
                    <li>‚Ä¢ Jab≈Çka 1kg - 5,99 PLN</li>
                </ul>
            </div>
        </div>

        <!-- Navigation -->
        <div class="flex justify-center">
            <a href="{% url 'chatbot:receipt_status' receipt.id %}"
               class="inline-flex items-center px-6 py-3 bg-secondary-100 hover:bg-secondary-200 text-secondary-700 font-medium rounded-xl transition-all duration-300 transform hover:scale-105 space-x-2">
                <span>‚¨ÖÔ∏è</span>
                <span>Wr√≥ƒá do statusu</span>
            </a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('ocr-review-form');
    const continueBtn = document.getElementById('continue-btn');
    const skipBtn = document.getElementById('skip-btn');
    const textArea = document.getElementById('id_ocr_text');

    // Skip button functionality
    skipBtn.addEventListener('click', function() {
        // Just submit the form as-is without changes
        form.submit();
    });

    // Form submission handling
    form.addEventListener('submit', function(e) {
        e.preventDefault();

        const text = textArea.value.trim();
        if (!text) {
            alert('Proszƒô wprowadziƒá tekst paragonu');
            return;
        }

        // Disable buttons during submission
        continueBtn.disabled = true;
        skipBtn.disabled = true;
        continueBtn.innerHTML = '<span class="text-xl">‚è≥</span><span>Przetwarzanie...</span>';

        // Submit the form
        form.submit();
    });

    // Auto-resize textarea
    textArea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = this.scrollHeight + 'px';
    });

    // Initial auto-resize
    textArea.style.height = textArea.scrollHeight + 'px';
});
</script>

{% endblock %}
